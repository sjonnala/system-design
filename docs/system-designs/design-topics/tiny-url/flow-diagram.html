<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TinyURL Architecture Flow Diagram</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            min-height: 100vh;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
            padding-bottom: 20px;
            border-bottom: 3px solid #667eea;
        }

        .header h1 {
            font-size: 2.5em;
            color: #2d3748;
            margin-bottom: 10px;
        }

        .tabs {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 20px;
        }

        .tab {
            padding: 12px 30px;
            background: #e2e8f0;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 1em;
            font-weight: 600;
            transition: all 0.3s;
        }

        .tab.active {
            background: #6366f1;
            color: white;
        }

        .tab:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }

        .diagram-container {
            display: none;
            margin-top: 30px;
        }

        .diagram-container.active {
            display: block;
        }

        svg {
            width: 100%;
            height: auto;
        }

        .component {
            cursor: pointer;
            transition: all 0.3s;
        }

        .component:hover {
            filter: drop-shadow(0 0 10px rgba(99, 102, 241, 0.5));
        }

        .component rect {
            transition: all 0.3s;
        }

        .component:hover rect {
            stroke-width: 3;
        }

        .flow-arrow {
            animation: dash 20s linear infinite;
        }

        @keyframes dash {
            to {
                stroke-dashoffset: -1000;
            }
        }

        .legend {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin-top: 30px;
            padding: 20px;
            background: #f8fafc;
            border-radius: 10px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .legend-color {
            width: 30px;
            height: 30px;
            border-radius: 5px;
            border: 2px solid #cbd5e0;
        }

        .info-box {
            position: absolute;
            background: white;
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.15);
            border: 2px solid #6366f1;
            display: none;
            z-index: 1000;
            max-width: 300px;
        }

        .info-box.show {
            display: block;
        }

        .metrics-panel {
            margin-top: 30px;
            padding: 25px;
            background: linear-gradient(135deg, #fef3c7 0%, #fde047 100%);
            border-radius: 15px;
            border: 2px solid #fbbf24;
        }

        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .metric-card {
            background: white;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            border-left: 4px solid #6366f1;
        }

        .metric-value {
            font-size: 1.8em;
            font-weight: 700;
            color: #6366f1;
        }

        .metric-label {
            font-size: 0.9em;
            color: #4a5568;
            margin-top: 5px;
        }

        .flow-description {
            background: #e0e7ff;
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
            border-left: 5px solid #6366f1;
        }

        .flow-description h3 {
            color: #4338ca;
            margin-bottom: 10px;
        }

        .flow-description ol {
            margin-left: 20px;
            line-height: 2;
            color: #1e293b;
        }

        .flow-description ol li {
            margin: 8px 0;
        }

        .flow-description strong {
            color: #6366f1;
        }
    </style>
</head>
<body>
<div class="container">
    <div class="header">
        <h1>üîó TinyURL Architecture Flow Diagram</h1>
        <p style="color: #64748b; margin-top: 10px;">Interactive Component Flow Visualization</p>

        <div class="tabs">
            <button class="tab active" onclick="showDiagram('write')">üìù Write Flow (URL Shortening)</button>
            <button class="tab" onclick="showDiagram('read')">üîÑ Read Flow (URL Redirection)</button>
            <button class="tab" onclick="showDiagram('full')">üèóÔ∏è Full System Architecture</button>
        </div>
    </div>

    <!-- Write Flow Diagram -->
    <div id="write-diagram" class="diagram-container active">
        <svg viewBox="0 0 1400 1100" xmlns="http://www.w3.org/2000/svg">
            <defs>
                <marker id="arrowhead-write" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
                    <polygon points="0 0, 10 3, 0 6" fill="#6366f1" />
                </marker>
                <linearGradient id="grad-client" x1="0%" y1="0%" x2="0%" y2="100%">
                    <stop offset="0%" style="stop-color:#60a5fa;stop-opacity:1" />
                    <stop offset="100%" style="stop-color:#3b82f6;stop-opacity:1" />
                </linearGradient>
                <linearGradient id="grad-cdn" x1="0%" y1="0%" x2="0%" y2="100%">
                    <stop offset="0%" style="stop-color:#22d3ee;stop-opacity:1" />
                    <stop offset="100%" style="stop-color:#06b6d4;stop-opacity:1" />
                </linearGradient>
                <linearGradient id="grad-lb" x1="0%" y1="0%" x2="0%" y2="100%">
                    <stop offset="0%" style="stop-color:#818cf8;stop-opacity:1" />
                    <stop offset="100%" style="stop-color:#6366f1;stop-opacity:1" />
                </linearGradient>
                <linearGradient id="grad-gateway" x1="0%" y1="0%" x2="0%" y2="100%">
                    <stop offset="0%" style="stop-color:#f87171;stop-opacity:1" />
                    <stop offset="100%" style="stop-color:#ef4444;stop-opacity:1" />
                </linearGradient>
                <linearGradient id="grad-service" x1="0%" y1="0%" x2="0%" y2="100%">
                    <stop offset="0%" style="stop-color:#84cc16;stop-opacity:1" />
                    <stop offset="100%" style="stop-color:#65a30d;stop-opacity:1" />
                </linearGradient>
                <linearGradient id="grad-idgen" x1="0%" y1="0%" x2="0%" y2="100%">
                    <stop offset="0%" style="stop-color:#facc15;stop-opacity:1" />
                    <stop offset="100%" style="stop-color:#eab308;stop-opacity:1" />
                </linearGradient>
                <linearGradient id="grad-cache" x1="0%" y1="0%" x2="0%" y2="100%">
                    <stop offset="0%" style="stop-color:#f472b6;stop-opacity:1" />
                    <stop offset="100%" style="stop-color:#ec4899;stop-opacity:1" />
                </linearGradient>
                <linearGradient id="grad-db" x1="0%" y1="0%" x2="0%" y2="100%">
                    <stop offset="0%" style="stop-color:#fb923c;stop-opacity:1" />
                    <stop offset="100%" style="stop-color:#f97316;stop-opacity:1" />
                </linearGradient>
                <linearGradient id="grad-queue" x1="0%" y1="0%" x2="0%" y2="100%">
                    <stop offset="0%" style="stop-color:#ef4444;stop-opacity:1" />
                    <stop offset="100%" style="stop-color:#dc2626;stop-opacity:1" />
                </linearGradient>
                <linearGradient id="grad-analytics" x1="0%" y1="0%" x2="0%" y2="100%">
                    <stop offset="0%" style="stop-color:#c084fc;stop-opacity:1" />
                    <stop offset="100%" style="stop-color:#a855f7;stop-opacity:1" />
                </linearGradient>
            </defs>

            <!-- Title -->
            <text x="700" y="30" font-size="24" font-weight="bold" text-anchor="middle" fill="#2d3748">
                Write Flow: Creating a Short URL
            </text>

            <!-- Client -->
            <g class="component" data-info="client">
                <rect x="600" y="60" width="200" height="80" rx="10" fill="url(#grad-client)" stroke="#2563eb" stroke-width="2"/>
                <text x="700" y="95" font-size="16" font-weight="bold" text-anchor="middle" fill="white">üë§ Client</text>
                <text x="700" y="115" font-size="12" text-anchor="middle" fill="white">Web/Mobile/API</text>
            </g>

            <!-- Arrow 1 -->
            <path d="M 700 140 L 700 180" stroke="#6366f1" stroke-width="3" fill="none" marker-end="url(#arrowhead-write)" class="flow-arrow" stroke-dasharray="5,5"/>
            <text x="720" y="165" font-size="11" fill="#4338ca" font-weight="600">POST /shorten</text>

            <!-- CDN / WAF -->
            <g class="component" data-info="cdn">
                <rect x="600" y="180" width="200" height="80" rx="10" fill="url(#grad-cdn)" stroke="#0891b2" stroke-width="2"/>
                <text x="700" y="215" font-size="16" font-weight="bold" text-anchor="middle" fill="white">‚ö° CDN / WAF</text>
                <text x="700" y="235" font-size="12" text-anchor="middle" fill="white">CloudFlare / Shield</text>
            </g>

            <!-- Arrow 2 -->
            <path d="M 700 260 L 700 300" stroke="#6366f1" stroke-width="3" fill="none" marker-end="url(#arrowhead-write)" class="flow-arrow" stroke-dasharray="5,5"/>
            <text x="720" y="285" font-size="11" fill="#4338ca" font-weight="600">DDoS Check</text>

            <!-- Load Balancer -->
            <g class="component" data-info="lb">
                <rect x="600" y="300" width="200" height="80" rx="10" fill="url(#grad-lb)" stroke="#4f46e5" stroke-width="2"/>
                <text x="700" y="335" font-size="16" font-weight="bold" text-anchor="middle" fill="white">‚öñÔ∏è Load Balancer</text>
                <text x="700" y="355" font-size="12" text-anchor="middle" fill="white">ALB / NGINX</text>
            </g>

            <!-- Arrow 3 -->
            <path d="M 700 380 L 700 420" stroke="#6366f1" stroke-width="3" fill="none" marker-end="url(#arrowhead-write)" class="flow-arrow" stroke-dasharray="5,5"/>
            <text x="720" y="405" font-size="11" fill="#4338ca" font-weight="600">Route</text>

            <!-- API Gateway -->
            <g class="component" data-info="gateway">
                <rect x="600" y="420" width="200" height="80" rx="10" fill="url(#grad-gateway)" stroke="#dc2626" stroke-width="2"/>
                <text x="700" y="455" font-size="16" font-weight="bold" text-anchor="middle" fill="white">üö™ API Gateway</text>
                <text x="700" y="475" font-size="12" text-anchor="middle" fill="white">Auth + Rate Limit</text>
            </g>

            <!-- Arrow 4 -->
            <path d="M 700 500 L 700 540" stroke="#6366f1" stroke-width="3" fill="none" marker-end="url(#arrowhead-write)" class="flow-arrow" stroke-dasharray="5,5"/>
            <text x="720" y="525" font-size="11" fill="#4338ca" font-weight="600">Validate & Forward</text>

            <!-- URL Shortening Service -->
            <g class="component" data-info="service">
                <rect x="550" y="540" width="300" height="100" rx="10" fill="url(#grad-service)" stroke="#4d7c0f" stroke-width="2"/>
                <text x="700" y="575" font-size="16" font-weight="bold" text-anchor="middle" fill="white">üîß URL Shortening Service</text>
                <text x="700" y="595" font-size="12" text-anchor="middle" fill="white">Spring Boot Microservice</text>
                <text x="700" y="615" font-size="11" text-anchor="middle" fill="white">‚Ä¢ Validate URL ‚Ä¢ Check Duplicates</text>
            </g>

            <!-- Arrow to ID Generator -->
            <path d="M 550 590 L 380 590" stroke="#6366f1" stroke-width="3" fill="none" marker-end="url(#arrowhead-write)" class="flow-arrow" stroke-dasharray="5,5"/>
            <text x="440" y="580" font-size="11" fill="#4338ca" font-weight="600">Request ID</text>

            <!-- ID Generator -->
            <g class="component" data-info="idgen">
                <rect x="200" y="550" width="180" height="80" rx="10" fill="url(#grad-idgen)" stroke="#ca8a04" stroke-width="2"/>
                <text x="290" y="585" font-size="14" font-weight="bold" text-anchor="middle" fill="white">üî¢ ID Generator</text>
                <text x="290" y="605" font-size="11" text-anchor="middle" fill="white">Base62 Encoding</text>
            </g>

            <!-- Arrow back from ID Generator -->
            <path d="M 380 600 L 550 600" stroke="#10b981" stroke-width="3" fill="none" marker-end="url(#arrowhead-write)" class="flow-arrow" stroke-dasharray="5,5"/>
            <text x="440" y="620" font-size="11" fill="#059669" font-weight="600">Return: Xy9K2p</text>

            <!-- Arrow to Database -->
            <path d="M 700 640 L 700 720" stroke="#6366f1" stroke-width="3" fill="none" marker-end="url(#arrowhead-write)" class="flow-arrow" stroke-dasharray="5,5"/>
            <text x="720" y="685" font-size="11" fill="#4338ca" font-weight="600">Store Mapping</text>

            <!-- Database -->
            <g class="component" data-info="db">
                <rect x="600" y="720" width="200" height="100" rx="10" fill="url(#grad-db)" stroke="#ea580c" stroke-width="2"/>
                <text x="700" y="755" font-size="16" font-weight="bold" text-anchor="middle" fill="white">üóÑÔ∏è PostgreSQL</text>
                <text x="700" y="775" font-size="12" text-anchor="middle" fill="white">URL Mappings Table</text>
                <text x="700" y="795" font-size="11" text-anchor="middle" fill="white">short_code ‚Üí long_url</text>
            </g>

            <!-- Arrow to Cache -->
            <path d="M 800 770 L 1020 770" stroke="#6366f1" stroke-width="3" fill="none" marker-end="url(#arrowhead-write)" class="flow-arrow" stroke-dasharray="5,5"/>
            <text x="880" y="760" font-size="11" fill="#4338ca" font-weight="600">Cache Write</text>

            <!-- Cache -->
            <g class="component" data-info="cache">
                <rect x="1020" y="720" width="180" height="100" rx="10" fill="url(#grad-cache)" stroke="#db2777" stroke-width="2"/>
                <text x="1110" y="755" font-size="14" font-weight="bold" text-anchor="middle" fill="white">üíæ Redis Cache</text>
                <text x="1110" y="775" font-size="11" text-anchor="middle" fill="white">SET short:Xy9K2p</text>
                <text x="1110" y="795" font-size="11" text-anchor="middle" fill="white">TTL: 24 hours</text>
            </g>

            <!-- Arrow to Queue -->
            <path d="M 850 590 L 1020 590" stroke="#6366f1" stroke-width="3" fill="none" marker-end="url(#arrowhead-write)" class="flow-arrow" stroke-dasharray="5,5"/>
            <text x="900" y="580" font-size="11" fill="#4338ca" font-weight="600">Publish Event</text>

            <!-- Message Queue -->
            <g class="component" data-info="queue">
                <rect x="1020" y="550" width="180" height="80" rx="10" fill="url(#grad-queue)" stroke="#b91c1c" stroke-width="2"/>
                <text x="1110" y="580" font-size="14" font-weight="bold" text-anchor="middle" fill="white">üì¨ Kafka</text>
                <text x="1110" y="600" font-size="11" text-anchor="middle" fill="white">url.created event</text>
            </g>

            <!-- Arrow to Analytics -->
            <path d="M 1110 630 L 1110 720" stroke="#6366f1" stroke-width="3" fill="none" marker-end="url(#arrowhead-write)" class="flow-arrow" stroke-dasharray="5,5"/>
            <text x="1130" y="680" font-size="11" fill="#4338ca" font-weight="600">Consume</text>

            <!-- Analytics Service -->
            <g class="component" data-info="analytics">
                <rect x="1020" y="860" width="180" height="80" rx="10" fill="url(#grad-analytics)" stroke="#9333ea" stroke-width="2"/>
                <text x="1110" y="890" font-size="14" font-weight="bold" text-anchor="middle" fill="white">üìä Analytics</text>
                <text x="1110" y="910" font-size="11" text-anchor="middle" fill="white">ClickHouse Store</text>
            </g>

            <!-- Response Arrow -->
            <path d="M 600 770 L 400 770 L 400 340 L 600 340" stroke="#10b981" stroke-width="4" fill="none" marker-end="url(#arrowhead-write)" stroke-dasharray="8,4"/>
            <text x="320" y="560" font-size="12" fill="#059669" font-weight="700">‚Üê Response</text>
            <text x="320" y="580" font-size="11" fill="#059669">200 OK</text>
            <text x="320" y="595" font-size="11" fill="#059669">{shortUrl: "tiny.url/Xy9K2p"}</text>

            <!-- Step numbers -->
            <circle cx="700" cy="100" r="18" fill="#fbbf24" stroke="#f59e0b" stroke-width="2"/>
            <text x="700" y="107" font-size="14" font-weight="bold" text-anchor="middle" fill="white">1</text>

            <circle cx="700" cy="220" r="18" fill="#fbbf24" stroke="#f59e0b" stroke-width="2"/>
            <text x="700" y="227" font-size="14" font-weight="bold" text-anchor="middle" fill="white">2</text>

            <circle cx="700" cy="340" r="18" fill="#fbbf24" stroke="#f59e0b" stroke-width="2"/>
            <text x="700" y="347" font-size="14" font-weight="bold" text-anchor="middle" fill="white">3</text>

            <circle cx="700" cy="460" r="18" fill="#fbbf24" stroke="#f59e0b" stroke-width="2"/>
            <text x="700" y="467" font-size="14" font-weight="bold" text-anchor="middle" fill="white">4</text>

            <circle cx="700" cy="590" r="18" fill="#fbbf24" stroke="#f59e0b" stroke-width="2"/>
            <text x="700" y="597" font-size="14" font-weight="bold" text-anchor="middle" fill="white">5</text>

            <circle cx="700" cy="760" r="18" fill="#fbbf24" stroke="#f59e0b" stroke-width="2"/>
            <text x="700" y="767" font-size="14" font-weight="bold" text-anchor="middle" fill="white">6</text>

            <circle cx="1110" cy="590" r="18" fill="#fbbf24" stroke="#f59e0b" stroke-width="2"/>
            <text x="1110" y="597" font-size="14" font-weight="bold" text-anchor="middle" fill="white">7</text>

            <circle cx="1110" cy="770" r="18" fill="#fbbf24" stroke="#f59e0b" stroke-width="2"/>
            <text x="1110" y="777" font-size="14" font-weight="bold" text-anchor="middle" fill="white">8</text>
        </svg>

        <div class="flow-description">
            <h3>üìù Write Flow Steps (URL Shortening)</h3>
            <ol>
                <li><strong>Client Request:</strong> User sends POST request with long URL to <code>tiny.url/api/shorten</code></li>
                <li><strong>CDN/WAF:</strong> CloudFlare checks for DDoS attacks, validates request, applies rate limiting</li>
                <li><strong>Load Balancer:</strong> ALB distributes request to healthy backend instances using Round Robin</li>
                <li><strong>API Gateway:</strong> Kong validates JWT token, checks API quota (10/hour free tier), validates URL format</li>
                <li><strong>URL Shortening Service:</strong>
                    <ul style="margin-left: 20px; margin-top: 5px;">
                        <li>Validates URL accessibility and security (no malware, phishing)</li>
                        <li>Checks if URL already shortened (deduplication via hash lookup)</li>
                        <li>Calls ID Generator service to get unique short code</li>
                    </ul>
                </li>
                <li><strong>Database Write:</strong> Stores mapping in PostgreSQL: <code>Xy9K2p ‚Üí https://example.com/long/url</code></li>
                <li><strong>Event Publishing:</strong> Publishes <code>url.created</code> event to Kafka for async processing</li>
                <li><strong>Cache Write:</strong> Stores mapping in Redis for fast reads (TTL: 24 hours)</li>
                <li><strong>Response:</strong> Returns short URL to client: <code>{"shortUrl": "tiny.url/Xy9K2p"}</code></li>
            </ol>
        </div>
    </div>

    <!-- Read Flow Diagram -->
    <div id="read-diagram" class="diagram-container">
        <svg viewBox="0 0 1400 1200" xmlns="http://www.w3.org/2000/svg">
            <!-- Title -->
            <text x="700" y="30" font-size="24" font-weight="bold" text-anchor="middle" fill="#2d3748">
                Read Flow: URL Redirection
            </text>

            <!-- Client -->
            <g class="component">
                <rect x="600" y="60" width="200" height="80" rx="10" fill="url(#grad-client)" stroke="#2563eb" stroke-width="2"/>
                <text x="700" y="95" font-size="16" font-weight="bold" text-anchor="middle" fill="white">üë§ Client</text>
                <text x="700" y="115" font-size="12" text-anchor="middle" fill="white">Browser / App</text>
            </g>

            <!-- Arrow -->
            <path d="M 700 140 L 700 180" stroke="#6366f1" stroke-width="3" fill="none" marker-end="url(#arrowhead-write)" class="flow-arrow" stroke-dasharray="5,5"/>
            <text x="720" y="165" font-size="11" fill="#4338ca" font-weight="600">GET /Xy9K2p</text>

            <!-- CDN Edge -->
            <g class="component">
                <rect x="550" y="180" width="300" height="100" rx="10" fill="url(#grad-cdn)" stroke="#0891b2" stroke-width="2"/>
                <text x="700" y="215" font-size="16" font-weight="bold" text-anchor="middle" fill="white">‚ö° CDN Edge Locations</text>
                <text x="700" y="235" font-size="12" text-anchor="middle" fill="white">CloudFront / Fastly</text>
                <text x="700" y="255" font-size="11" text-anchor="middle" fill="white">Cache popular URLs (304 redirects)</text>
            </g>

            <!-- Decision Diamond -->
            <g class="component">
                <path d="M 700 320 L 800 380 L 700 440 L 600 380 Z" fill="#fef3c7" stroke="#f59e0b" stroke-width="3"/>
                <text x="700" y="375" font-size="13" font-weight="bold" text-anchor="middle" fill="#92400e">Cache</text>
                <text x="700" y="393" font-size="13" font-weight="bold" text-anchor="middle" fill="#92400e">Hit?</text>
            </g>

            <!-- Cache Hit Path (Right) -->
            <path d="M 800 380 L 950 380" stroke="#10b981" stroke-width="4" fill="none" marker-end="url(#arrowhead-write)"/>
            <text x="850" y="370" font-size="12" fill="#059669" font-weight="700">YES ‚úì</text>
            <text x="820" y="395" font-size="11" fill="#059669">(80% requests)</text>

            <g class="component">
                <rect x="950" y="330" width="200" height="100" rx="10" fill="#d1fae5" stroke="#10b981" stroke-width="3"/>
                <text x="1050" y="365" font-size="14" font-weight="bold" text-anchor="middle" fill="#065f46">‚úÖ Edge Response</text>
                <text x="1050" y="385" font-size="12" text-anchor="middle" fill="#065f46">301 Redirect</text>
                <text x="1050" y="405" font-size="11" text-anchor="middle" fill="#065f46">Latency: ~10ms</text>
            </g>

            <path d="M 1050 330 L 1050 100 L 800 100" stroke="#10b981" stroke-width="4" fill="none" marker-end="url(#arrowhead-write)" stroke-dasharray="8,4"/>
            <text x="1070" y="220" font-size="12" fill="#059669" font-weight="700">Fast Path</text>

            <!-- Cache Miss Path (Bottom) -->
            <path d="M 700 440 L 700 500" stroke="#ef4444" stroke-width="4" fill="none" marker-end="url(#arrowhead-write)"/>
            <text x="630" y="475" font-size="12" fill="#dc2626" font-weight="700">NO ‚úó (20%)</text>

            <!-- Load Balancer -->
            <g class="component">
                <rect x="600" y="500" width="200" height="80" rx="10" fill="url(#grad-lb)" stroke="#4f46e5" stroke-width="2"/>
                <text x="700" y="535" font-size="16" font-weight="bold" text-anchor="middle" fill="white">‚öñÔ∏è Load Balancer</text>
                <text x="700" y="555" font-size="12" text-anchor="middle" fill="white">Route to Backend</text>
            </g>

            <!-- Arrow -->
            <path d="M 700 580 L 700 620" stroke="#6366f1" stroke-width="3" fill="none" marker-end="url(#arrowhead-write)" class="flow-arrow" stroke-dasharray="5,5"/>

            <!-- Redirection Service -->
            <g class="component">
                <rect x="550" y="620" width="300" height="100" rx="10" fill="url(#grad-service)" stroke="#4d7c0f" stroke-width="2"/>
                <text x="700" y="655" font-size="16" font-weight="bold" text-anchor="middle" fill="white">üîÑ Redirection Service</text>
                <text x="700" y="675" font-size="12" text-anchor="middle" fill="white">High-performance Read Service</text>
                <text x="700" y="695" font-size="11" text-anchor="middle" fill="white">Connection Pooling ‚Ä¢ Bloom Filter</text>
            </g>

            <!-- Arrow to Redis -->
            <path d="M 850 670 L 1020 670" stroke="#6366f1" stroke-width="3" fill="none" marker-end="url(#arrowhead-write)" class="flow-arrow" stroke-dasharray="5,5"/>
            <text x="900" y="660" font-size="11" fill="#4338ca" font-weight="600">Check Cache</text>

            <!-- Redis Cache -->
            <g class="component">
                <rect x="1020" y="620" width="200" height="100" rx="10" fill="url(#grad-cache)" stroke="#db2777" stroke-width="2"/>
                <text x="1120" y="655" font-size="14" font-weight="bold" text-anchor="middle" fill="white">üíæ Redis Cluster</text>
                <text x="1120" y="675" font-size="11" text-anchor="middle" fill="white">GET short:Xy9K2p</text>
                <text x="1120" y="695" font-size="11" text-anchor="middle" fill="white">Hit Rate: 80-85%</text>
            </g>

            <!-- Cache Hit/Miss Decision -->
            <g class="component">
                <path d="M 700 760 L 800 820 L 700 880 L 600 820 Z" fill="#fef3c7" stroke="#f59e0b" stroke-width="3"/>
                <text x="700" y="815" font-size="13" font-weight="bold" text-anchor="middle" fill="#92400e">Redis</text>
                <text x="700" y="833" font-size="13" font-weight="bold" text-anchor="middle" fill="#92400e">Hit?</text>
            </g>

            <!-- Redis Hit (Right) -->
            <path d="M 800 820 L 950 820" stroke="#10b981" stroke-width="4" fill="none" marker-end="url(#arrowhead-write)"/>
            <text x="850" y="810" font-size="12" fill="#059669" font-weight="700">YES ‚úì</text>

            <g class="component">
                <rect x="950" y="770" width="180" height="100" rx="10" fill="#d1fae5" stroke="#10b981" stroke-width="3"/>
                <text x="1040" y="805" font-size="14" font-weight="bold" text-anchor="middle" fill="#065f46">‚úÖ Return URL</text>
                <text x="1040" y="825" font-size="11" text-anchor="middle" fill="#065f46">301 Redirect</text>
                <text x="1040" y="845" font-size="11" text-anchor="middle" fill="#065f46">Latency: ~50ms</text>
            </g>

            <!-- Redis Miss (Bottom) -->
            <path d="M 700 880 L 700 940" stroke="#ef4444" stroke-width="4" fill="none" marker-end="url(#arrowhead-write)"/>
            <text x="630" y="915" font-size="12" fill="#dc2626" font-weight="700">NO ‚úó (15-20%)</text>

            <!-- PostgreSQL -->
            <g class="component">
                <rect x="550" y="940" width="300" height="100" rx="10" fill="url(#grad-db)" stroke="#ea580c" stroke-width="2"/>
                <text x="700" y="975" font-size="16" font-weight="bold" text-anchor="middle" fill="white">üóÑÔ∏è PostgreSQL</text>
                <text x="700" y="995" font-size="12" text-anchor="middle" fill="white">Read Replica (CQRS)</text>
                <text x="700" y="1015" font-size="11" text-anchor="middle" fill="white">SELECT long_url WHERE short_code='Xy9K2p'</text>
            </g>

            <!-- Update Redis -->
            <path d="M 850 990 L 1020 820" stroke="#6366f1" stroke-width="3" fill="none" marker-end="url(#arrowhead-write)" stroke-dasharray="5,5"/>
            <text x="900" y="900" font-size="11" fill="#4338ca" font-weight="600">Update Cache</text>

            <!-- Response Path -->
            <path d="M 1040 770 L 1040 540 L 800 540" stroke="#10b981" stroke-width="4" fill="none" marker-end="url(#arrowhead-write)" stroke-dasharray="8,4"/>

            <!-- Async Analytics -->
            <path d="M 550 670 L 200 670 L 200 820" stroke="#9333ea" stroke-width="3" fill="none" marker-end="url(#arrowhead-write)" stroke-dasharray="3,3"/>
            <text x="350" y="660" font-size="10" fill="#9333ea">Async Log</text>

            <g class="component">
                <rect x="100" y="820" width="200" height="100" rx="10" fill="url(#grad-analytics)" stroke="#9333ea" stroke-width="2"/>
                <text x="200" y="855" font-size="14" font-weight="bold" text-anchor="middle" fill="white">üìä Analytics</text>
                <text x="200" y="875" font-size="11" text-anchor="middle" fill="white">Log click event:</text>
                <text x="200" y="895" font-size="10" text-anchor="middle" fill="white">IP, Location, Device</text>
            </g>

            <!-- Step Numbers -->
            <circle cx="700" cy="100" r="18" fill="#fbbf24" stroke="#f59e0b" stroke-width="2"/>
            <text x="700" y="107" font-size="14" font-weight="bold" text-anchor="middle" fill="white">1</text>

            <circle cx="700" cy="230" r="18" fill="#fbbf24" stroke="#f59e0b" stroke-width="2"/>
            <text x="700" y="237" font-size="14" font-weight="bold" text-anchor="middle" fill="white">2</text>

            <circle cx="700" cy="540" r="18" fill="#fbbf24" stroke="#f59e0b" stroke-width="2"/>
            <text x="700" y="547" font-size="14" font-weight="bold" text-anchor="middle" fill="white">3</text>

            <circle cx="700" cy="670" r="18" fill="#fbbf24" stroke="#f59e0b" stroke-width="2"/>
            <text x="700" y="677" font-size="14" font-weight="bold" text-anchor="middle" fill="white">4</text>

            <circle cx="1120" cy="670" r="18" fill="#fbbf24" stroke="#f59e0b" stroke-width="2"/>
            <text x="1120" y="677" font-size="14" font-weight="bold" text-anchor="middle" fill="white">5</text>

            <circle cx="700" cy="990" r="18" fill="#fbbf24" stroke="#f59e0b" stroke-width="2"/>
            <text x="700" y="997" font-size="14" font-weight="bold" text-anchor="middle" fill="white">6</text>
        </svg>

        <div class="flow-description">
            <h3>üîÑ Read Flow Steps (URL Redirection)</h3>
            <ol>
                <li><strong>Client Request:</strong> User clicks short URL: <code>tiny.url/Xy9K2p</code> in browser</li>
                <li><strong>CDN Edge Check:</strong> CloudFront checks if this URL is cached at edge location
                    <ul style="margin-left: 20px; margin-top: 5px;">
                        <li><strong>Cache Hit (80%):</strong> Returns 301 redirect immediately (~10ms latency) ‚úÖ</li>
                        <li><strong>Cache Miss (20%):</strong> Forwards to origin servers ‚Üì</li>
                    </ul>
                </li>
                <li><strong>Load Balancer:</strong> Routes request to healthy Redirection Service instance</li>
                <li><strong>Redirection Service:</strong>
                    <ul style="margin-left: 20px; margin-top: 5px;">
                        <li>Checks Bloom filter (fast negative lookup for non-existent URLs)</li>
                        <li>Queries Redis cache with short code</li>
                    </ul>
                </li>
                <li><strong>Redis Cache:</strong>
                    <ul style="margin-left: 20px; margin-top: 5px;">
                        <li><strong>Cache Hit (80-85%):</strong> Returns long URL (~50ms latency) ‚úÖ</li>
                        <li><strong>Cache Miss (15-20%):</strong> Query database ‚Üì</li>
                    </ul>
                </li>
                <li><strong>PostgreSQL Query:</strong> Reads from replica: <code>SELECT long_url WHERE short_code='Xy9K2p'</code>
                    <ul style="margin-left: 20px; margin-top: 5px;">
                        <li>Updates Redis cache with result (for future requests)</li>
                        <li>Returns long URL (~150ms total latency)</li>
                    </ul>
                </li>
                <li><strong>Response:</strong> Returns <code>HTTP 301 Moved Permanently</code> with <code>Location: https://example.com/long/url</code></li>
                <li><strong>Async Analytics:</strong> Logs click event to Kafka (non-blocking) ‚Üí stored in ClickHouse for dashboards</li>
            </ol>
            <div style="margin-top: 15px; padding: 15px; background: #fef3c7; border-left: 4px solid #f59e0b; border-radius: 5px;">
                <strong>üéØ Performance Optimization:</strong> Multi-tier caching strategy reduces database load by 95%, enabling 10,000+ QPS read throughput!
            </div>
        </div>
    </div>

    <!-- Full System Architecture -->
    <div id="full-diagram" class="diagram-container">
        <svg viewBox="0 0 1600 1400" xmlns="http://www.w3.org/2000/svg">
            <!-- Title -->
            <text x="800" y="35" font-size="28" font-weight="bold" text-anchor="middle" fill="#2d3748">
                Complete TinyURL System Architecture
            </text>

            <!-- Layer Labels -->
            <text x="50" y="100" font-size="14" font-weight="bold" fill="#64748b">CLIENT LAYER</text>
            <text x="50" y="220" font-size="14" font-weight="bold" fill="#64748b">EDGE LAYER</text>
            <text x="50" y="360" font-size="14" font-weight="bold" fill="#64748b">GATEWAY</text>
            <text x="50" y="520" font-size="14" font-weight="bold" fill="#64748b">APPLICATION</text>
            <text x="50" y="900" font-size="14" font-weight="bold" fill="#64748b">DATA LAYER</text>
            <text x="50" y="1200" font-size="14" font-weight="bold" fill="#64748b">ANALYTICS</text>

            <!-- Horizontal Dividers -->
            <line x1="200" y1="180" x2="1550" y2="180" stroke="#e2e8f0" stroke-width="2" stroke-dasharray="10,5"/>
            <line x1="200" y1="330" x2="1550" y2="330" stroke="#e2e8f0" stroke-width="2" stroke-dasharray="10,5"/>
            <line x1="200" y1="470" x2="1550" y2="470" stroke="#e2e8f0" stroke-width="2" stroke-dasharray="10,5"/>
            <line x1="200" y1="850" x2="1550" y2="850" stroke="#e2e8f0" stroke-width="2" stroke-dasharray="10,5"/>
            <line x1="200" y1="1150" x2="1550" y2="1150" stroke="#e2e8f0" stroke-width="2" stroke-dasharray="10,5"/>

            <!-- CLIENT LAYER -->
            <g class="component">
                <rect x="300" y="70" width="150" height="70" rx="10" fill="url(#grad-client)" stroke="#2563eb" stroke-width="2"/>
                <text x="375" y="100" font-size="14" font-weight="bold" text-anchor="middle" fill="white">üíª Web Client</text>
            </g>
            <g class="component">
                <rect x="500" y="70" width="150" height="70" rx="10" fill="url(#grad-client)" stroke="#2563eb" stroke-width="2"/>
                <text x="575" y="100" font-size="14" font-weight="bold" text-anchor="middle" fill="white">üì± Mobile App</text>
            </g>
            <g class="component">
                <rect x="700" y="70" width="150" height="70" rx="10" fill="url(#grad-client)" stroke="#2563eb" stroke-width="2"/>
                <text x="775" y="100" font-size="14" font-weight="bold" text-anchor="middle" fill="white">üîå API Client</text>
            </g>

            <!-- Arrows down -->
            <path d="M 375 140 L 375 210" stroke="#6366f1" stroke-width="2" fill="none" marker-end="url(#arrowhead-write)"/>
            <path d="M 575 140 L 575 210" stroke="#6366f1" stroke-width="2" fill="none" marker-end="url(#arrowhead-write)"/>
            <path d="M 775 140 L 775 210" stroke="#6366f1" stroke-width="2" fill="none" marker-end="url(#arrowhead-write)"/>

            <!-- EDGE LAYER -->
            <g class="component">
                <rect x="250" y="210" width="180" height="80" rx="10" fill="url(#grad-cdn)" stroke="#0891b2" stroke-width="2"/>
                <text x="340" y="245" font-size="13" font-weight="bold" text-anchor="middle" fill="white">‚ö° CDN Edge</text>
                <text x="340" y="265" font-size="10" text-anchor="middle" fill="white">CloudFront</text>
            </g>
            <g class="component">
                <rect x="470" y="210" width="180" height="80" rx="10" fill="#fee2e2" stroke="#dc2626" stroke-width="2"/>
                <text x="560" y="245" font-size="13" font-weight="bold" text-anchor="middle" fill="#991b1b">üõ°Ô∏è WAF / Shield</text>
                <text x="560" y="265" font-size="10" text-anchor="middle" fill="#991b1b">DDoS Protection</text>
            </g>
            <g class="component">
                <rect x="690" y="210" width="180" height="80" rx="10" fill="#fef3c7" stroke="#f59e0b" stroke-width="2"/>
                <text x="780" y="245" font-size="13" font-weight="bold" text-anchor="middle" fill="#92400e">üåê DNS</text>
                <text x="780" y="265" font-size="10" text-anchor="middle" fill="#92400e">Route 53</text>
            </g>

            <!-- Arrows down -->
            <path d="M 560 290 L 560 360" stroke="#6366f1" stroke-width="3" fill="none" marker-end="url(#arrowhead-write)"/>

            <!-- GATEWAY LAYER -->
            <g class="component">
                <rect x="350" y="360" width="200" height="80" rx="10" fill="url(#grad-lb)" stroke="#4f46e5" stroke-width="2"/>
                <text x="450" y="395" font-size="14" font-weight="bold" text-anchor="middle" fill="white">‚öñÔ∏è Load Balancer</text>
                <text x="450" y="415" font-size="10" text-anchor="middle" fill="white">ALB / NGINX</text>
            </g>
            <g class="component">
                <rect x="600" y="360" width="200" height="80" rx="10" fill="url(#grad-gateway)" stroke="#dc2626" stroke-width="2"/>
                <text x="700" y="395" font-size="14" font-weight="bold" text-anchor="middle" fill="white">üö™ API Gateway</text>
                <text x="700" y="415" font-size="10" text-anchor="middle" fill="white">Auth + Rate Limit</text>
            </g>

            <!-- Arrows down -->
            <path d="M 450 440 L 450 520" stroke="#6366f1" stroke-width="2" fill="none" marker-end="url(#arrowhead-write)"/>
            <path d="M 700 440 L 700 520" stroke="#6366f1" stroke-width="2" fill="none" marker-end="url(#arrowhead-write)"/>

            <!-- APPLICATION LAYER -->
            <g class="component">
                <rect x="250" y="520" width="180" height="90" rx="10" fill="url(#grad-service)" stroke="#4d7c0f" stroke-width="2"/>
                <text x="340" y="555" font-size="13" font-weight="bold" text-anchor="middle" fill="white">üîß URL Shortening</text>
                <text x="340" y="573" font-size="10" text-anchor="middle" fill="white">Spring Boot</text>
            </g>
            <g class="component">
                <rect x="460" y="520" width="180" height="90" rx="10" fill="url(#grad-service)" stroke="#4d7c0f" stroke-width="2"/>
                <text x="550" y="555" font-size="13" font-weight="bold" text-anchor="middle" fill="white">üîÑ Redirection</text>
                <text x="550" y="573" font-size="10" text-anchor="middle" fill="white">High-perf Read</text>
            </g>
            <g class="component">
                <rect x="670" y="520" width="180" height="90" rx="10" fill="url(#grad-service)" stroke="#4d7c0f" stroke-width="2"/>
                <text x="760" y="555" font-size="13" font-weight="bold" text-anchor="middle" fill="white">üë§ User Mgmt</text>
                <text x="760" y="573" font-size="10" text-anchor="middle" fill="white">Auth Service</text>
            </g>

            <!-- Supporting Services -->
            <g class="component">
                <rect x="250" y="650" width="150" height="70" rx="10" fill="url(#grad-idgen)" stroke="#ca8a04" stroke-width="2"/>
                <text x="325" y="680" font-size="12" font-weight="bold" text-anchor="middle" fill="white">üî¢ ID Generator</text>
                <text x="325" y="698" font-size="9" text-anchor="middle" fill="white">Base62</text>
            </g>
            <g class="component">
                <rect x="430" y="650" width="150" height="70" rx="10" fill="#e0e7ff" stroke="#6366f1" stroke-width="2"/>
                <text x="505" y="680" font-size="11" font-weight="bold" text-anchor="middle" fill="#4338ca">üîç Bloom Filter</text>
                <text x="505" y="698" font-size="9" text-anchor="middle" fill="#4338ca">Fast Lookup</text>
            </g>
            <g class="component">
                <rect x="610" y="650" width="150" height="70" rx="10" fill="#fce7f3" stroke="#db2777" stroke-width="2"/>
                <text x="685" y="680" font-size="11" font-weight="bold" text-anchor="middle" fill="#831843">üîê Auth Service</text>
                <text x="685" y="698" font-size="9" text-anchor="middle" fill="#831843">JWT / OAuth</text>
            </g>

            <!-- Message Queue -->
            <g class="component">
                <rect x="250" y="750" width="510" height="70" rx="10" fill="url(#grad-queue)" stroke="#b91c1c" stroke-width="2"/>
                <text x="505" y="780" font-size="14" font-weight="bold" text-anchor="middle" fill="white">üì¨ Apache Kafka / AWS SQS</text>
                <text x="505" y="800" font-size="10" text-anchor="middle" fill="white">Topics: url.created | url.clicked | url.expired</text>
            </g>

            <!-- Arrows from services to Kafka -->
            <path d="M 340 610 L 340 750" stroke="#6366f1" stroke-width="2" fill="none" marker-end="url(#arrowhead-write)" stroke-dasharray="5,5"/>
            <path d="M 550 610 L 550 750" stroke="#6366f1" stroke-width="2" fill="none" marker-end="url(#arrowhead-write)" stroke-dasharray="5,5"/>

            <!-- Arrows to Data Layer -->
            <path d="M 340 610 L 400 900" stroke="#6366f1" stroke-width="2" fill="none" marker-end="url(#arrowhead-write)"/>
            <path d="M 550 610 L 500 900" stroke="#6366f1" stroke-width="2" fill="none" marker-end="url(#arrowhead-write)"/>
            <path d="M 550 610 L 700 900" stroke="#6366f1" stroke-width="2" fill="none" marker-end="url(#arrowhead-write)"/>

            <!-- DATA LAYER -->
            <g class="component">
                <rect x="250" y="900" width="200" height="120" rx="10" fill="url(#grad-db)" stroke="#ea580c" stroke-width="2"/>
                <text x="350" y="940" font-size="14" font-weight="bold" text-anchor="middle" fill="white">üóÑÔ∏è PostgreSQL</text>
                <text x="350" y="960" font-size="11" text-anchor="middle" fill="white">Master (Write)</text>
                <text x="350" y="978" font-size="9" text-anchor="middle" fill="white">Sharded by short_code</text>
            </g>
            <g class="component">
                <rect x="480" y="900" width="200" height="120" rx="10" fill="#fed7aa" stroke="#ea580c" stroke-width="2"/>
                <text x="580" y="940" font-size="13" font-weight="bold" text-anchor="middle" fill="#9a3412">üìö Read Replicas</text>
                <text x="580" y="960" font-size="10" text-anchor="middle" fill="#9a3412">3x Replicas</text>
                <text x="580" y="978" font-size="9" text-anchor="middle" fill="#9a3412">Async Replication</text>
            </g>
            <g class="component">
                <rect x="710" y="900" width="200" height="120" rx="10" fill="url(#grad-cache)" stroke="#db2777" stroke-width="2"/>
                <text x="810" y="940" font-size="14" font-weight="bold" text-anchor="middle" fill="white">üíæ Redis Cluster</text>
                <text x="810" y="960" font-size="10" text-anchor="middle" fill="white">Master-Replica</text>
                <text x="810" y="978" font-size="9" text-anchor="middle" fill="white">LRU Eviction</text>
            </g>

            <!-- Object Storage -->
            <g class="component">
                <rect x="940" y="900" width="180" height="120" rx="10" fill="#bae6fd" stroke="#0284c7" stroke-width="2"/>
                <text x="1030" y="940" font-size="13" font-weight="bold" text-anchor="middle" fill="#075985">‚òÅÔ∏è S3 / Blob</text>
                <text x="1030" y="960" font-size="10" text-anchor="middle" fill="#075985">QR Codes</text>
                <text x="1030" y="978" font-size="9" text-anchor="middle" fill="#075985">Backups</text>
            </g>

            <!-- Replication arrows -->
            <path d="M 450 960 L 480 960" stroke="#f97316" stroke-width="2" fill="none" marker-end="url(#arrowhead-write)"/>
            <text x="465" y="950" font-size="9" fill="#9a3412">replicate</text>

            <!-- Cache arrows -->
            <path d="M 680 960 L 710 960" stroke="#ec4899" stroke-width="2" fill="none" marker-end="url(#arrowhead-write)" stroke-dasharray="3,3"/>
            <text x="695" y="950" font-size="9" fill="#831843">cache</text>

            <!-- Arrow from Kafka to Analytics -->
            <path d="M 505 820 L 505 1200" stroke="#9333ea" stroke-width="3" fill="none" marker-end="url(#arrowhead-write)" stroke-dasharray="5,5"/>

            <!-- ANALYTICS LAYER -->
            <g class="component">
                <rect x="250" y="1200" width="220" height="100" rx="10" fill="url(#grad-analytics)" stroke="#9333ea" stroke-width="2"/>
                <text x="360" y="1235" font-size="14" font-weight="bold" text-anchor="middle" fill="white">üìä ClickHouse</text>
                <text x="360" y="1255" font-size="11" text-anchor="middle" fill="white">Time-Series Analytics</text>
                <text x="360" y="1275" font-size="9" text-anchor="middle" fill="white">Click Events ‚Ä¢ Aggregations</text>
            </g>
            <g class="component">
                <rect x="500" y="1200" width="200" height="100" rx="10" fill="#fef3c7" stroke="#f59e0b" stroke-width="2"/>
                <text x="600" y="1235" font-size="13" font-weight="bold" text-anchor="middle" fill="#92400e">üîç Elasticsearch</text>
                <text x="600" y="1255" font-size="10" text-anchor="middle" fill="#92400e">Full-text Search</text>
                <text x="600" y="1275" font-size="9" text-anchor="middle" fill="#92400e">User Activity Logs</text>
            </g>
            <g class="component">
                <rect x="730" y="1200" width="200" height="100" rx="10" fill="#e0f2fe" stroke="#0284c7" stroke-width="2"/>
                <text x="830" y="1235" font-size="13" font-weight="bold" text-anchor="middle" fill="#075985">üìà Grafana</text>
                <text x="830" y="1255" font-size="10" text-anchor="middle" fill="#075985">Dashboards</text>
                <text x="830" y="1275" font-size="9" text-anchor="middle" fill="#075985">Real-time Metrics</text>
            </g>

            <!-- MONITORING (Right side) -->
            <g class="component">
                <rect x="1200" y="520" width="280" height="100" rx="10" fill="#d1fae5" stroke="#10b981" stroke-width="2"/>
                <text x="1340" y="555" font-size="14" font-weight="bold" text-anchor="middle" fill="#065f46">üìà MONITORING</text>
                <text x="1340" y="575" font-size="11" text-anchor="middle" fill="#065f46">‚Ä¢ Prometheus + Grafana</text>
                <text x="1340" y="593" font-size="11" text-anchor="middle" fill="#065f46">‚Ä¢ ELK Stack (Logging)</text>
                <text x="1340" y="611" font-size="11" text-anchor="middle" fill="#065f46">‚Ä¢ Jaeger (Tracing)</text>
            </g>

            <g class="component">
                <rect x="1200" y="650" width="280" height="100" rx="10" fill="#fee2e2" stroke="#dc2626" stroke-width="2"/>
                <text x="1340" y="685" font-size="14" font-weight="bold" text-anchor="middle" fill="#991b1b">üö® ALERTING</text>
                <text x="1340" y="705" font-size="11" text-anchor="middle" fill="#991b1b">‚Ä¢ PagerDuty / OpsGenie</text>
                <text x="1340" y="723" font-size="11" text-anchor="middle" fill="#991b1b">‚Ä¢ Health Checks</text>
                <text x="1340" y="741" font-size="11" text-anchor="middle" fill="#991b1b">‚Ä¢ Circuit Breakers</text>
            </g>

            <!-- Monitoring arrows -->
            <path d="M 850 565 L 1200 565" stroke="#10b981" stroke-width="2" fill="none" stroke-dasharray="3,3"/>
            <path d="M 760 720 L 1200 700" stroke="#dc2626" stroke-width="2" fill="none" stroke-dasharray="3,3"/>

            <!-- Data Flow Indicators -->
            <text x="950" y="540" font-size="12" fill="#6366f1" font-weight="600">‚Üê Metrics</text>
            <text x="950" y="710" font-size="12" fill="#ef4444" font-weight="600">‚Üê Alerts</text>
        </svg>

        <div class="flow-description">
            <h3>üèóÔ∏è Full System Architecture Overview</h3>
            <p style="margin-bottom: 15px; line-height: 1.8;">
                This diagram shows the complete TinyURL system with all layers working together.
                The architecture follows a <strong>microservices pattern</strong> with clear separation of concerns
                and <strong>CQRS (Command Query Responsibility Segregation)</strong> for optimal read/write performance.
            </p>
            <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px; margin-top: 20px;">
                <div style="background: #f0f9ff; padding: 15px; border-radius: 10px; border-left: 4px solid #0284c7;">
                    <h4 style="color: #075985; margin-bottom: 8px;">‚¨ÜÔ∏è Write Path</h4>
                    <p style="font-size: 0.9em; color: #0c4a6e; line-height: 1.6;">
                        Client ‚Üí CDN ‚Üí LB ‚Üí API Gateway ‚Üí <strong>URL Shortening Service</strong> ‚Üí
                        PostgreSQL Master ‚Üí Redis Cache ‚Üí Kafka ‚Üí Analytics
                    </p>
                </div>
                <div style="background: #f0fdf4; padding: 15px; border-radius: 10px; border-left: 4px solid #10b981;">
                    <h4 style="color: #065f46; margin-bottom: 8px;">‚¨áÔ∏è Read Path</h4>
                    <p style="font-size: 0.9em; color: #064e3b; line-height: 1.6;">
                        Client ‚Üí CDN (80% cached) ‚Üí LB ‚Üí <strong>Redirection Service</strong> ‚Üí
                        Redis (85% hit) ‚Üí PostgreSQL Replicas ‚Üí Response
                    </p>
                </div>
            </div>
        </div>
    </div>

    <!-- Metrics Panel -->
    <div class="metrics-panel">
        <h2 style="margin-bottom: 15px; color: #92400e;">‚ö° System Performance Metrics</h2>
        <div class="metrics-grid">
            <div class="metric-card">
                <div class="metric-value">10K</div>
                <div class="metric-label">QPS (Read)</div>
            </div>
            <div class="metric-card">
                <div class="metric-value">500</div>
                <div class="metric-label">QPS (Write)</div>
            </div>
            <div class="metric-card">
                <div class="metric-value">10ms</div>
                <div class="metric-label">P50 Latency</div>
            </div>
            <div class="metric-card">
                <div class="metric-value">50ms</div>
                <div class="metric-label">P95 Latency</div>
            </div>
            <div class="metric-card">
                <div class="metric-value">85%</div>
                <div class="metric-label">Cache Hit Rate</div>
            </div>
            <div class="metric-card">
                <div class="metric-value">99.99%</div>
                <div class="metric-label">Availability</div>
            </div>
        </div>
    </div>

    <!-- Legend -->
    <div class="legend">
        <div class="legend-item">
            <div class="legend-color" style="background: linear-gradient(135deg, #60a5fa, #3b82f6);"></div>
            <span>Client Layer</span>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background: linear-gradient(135deg, #22d3ee, #06b6d4);"></div>
            <span>Edge/CDN</span>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background: linear-gradient(135deg, #f87171, #ef4444);"></div>
            <span>Gateway</span>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background: linear-gradient(135deg, #84cc16, #65a30d);"></div>
            <span>Services</span>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background: linear-gradient(135deg, #f472b6, #ec4899);"></div>
            <span>Cache</span>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background: linear-gradient(135deg, #fb923c, #f97316);"></div>
            <span>Database</span>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background: linear-gradient(135deg, #c084fc, #a855f7);"></div>
            <span>Analytics</span>
        </div>
    </div>
</div>

<script>
    function showDiagram(type) {
        // Hide all diagrams
        document.querySelectorAll('.diagram-container').forEach(d => {
            d.classList.remove('active');
        });

        // Remove active from all tabs
        document.querySelectorAll('.tab').forEach(t => {
            t.classList.remove('active');
        });

        // Show selected diagram
        document.getElementById(type + '-diagram').classList.add('active');

        // Activate clicked tab
        event.target.classList.add('active');
    }

    // Add hover effects
    document.querySelectorAll('.component').forEach(comp => {
        comp.addEventListener('mouseenter', function() {
            this.style.filter = 'drop-shadow(0 0 15px rgba(99, 102, 241, 0.6))';
        });

        comp.addEventListener('mouseleave', function() {
            this.style.filter = 'none';
        });
    });
</script>
</body>
</html>