<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Priority Queue System Design Blueprint</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            min-height: 100vh;
        }

        .container {
            max-width: 1800px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
            padding-bottom: 20px;
            border-bottom: 3px solid #667eea;
        }

        .header h1 {
            font-size: 2.5em;
            color: #2d3748;
            margin-bottom: 10px;
        }

        .header .subtitle {
            font-size: 1.3em;
            color: #667eea;
            font-weight: 600;
        }

        .tags {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 15px;
        }

        .tag {
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.9em;
            font-weight: 600;
        }

        .tag.throughput { background: #fef3c7; color: #92400e; }
        .tag.consensus { background: #fee2e2; color: #991b1b; }
        .tag.scale { background: #dbeafe; color: #1e40af; }

        .architecture {
            display: grid;
            grid-template-columns: repeat(12, 1fr);
            gap: 20px;
            margin-top: 30px;
        }

        .section {
            padding: 20px;
            border-radius: 15px;
            border: 2px solid #e2e8f0;
            position: relative;
            min-height: 200px;
        }

        .section-title {
            font-weight: 700;
            font-size: 1.1em;
            margin-bottom: 15px;
            color: #1a202c;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .component {
            background: white;
            padding: 15px;
            margin: 10px 0;
            border-radius: 10px;
            border: 2px solid #cbd5e0;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
        }

        .component:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 15px rgba(0,0,0,0.2);
        }

        .component-name {
            font-weight: 700;
            font-size: 1em;
            margin-bottom: 8px;
            color: #2d3748;
        }

        .component-details {
            font-size: 0.85em;
            color: #4a5568;
            line-height: 1.6;
        }

        .component-details ul {
            margin-left: 15px;
            margin-top: 5px;
        }

        .component-details li {
            margin: 3px 0;
        }

        /* Color themes for different sections */
        .producers-section {
            background: linear-gradient(135deg, #bfdbfe 0%, #60a5fa 100%);
            grid-column: span 4;
        }

        .gateway-section {
            background: linear-gradient(135deg, #a5f3fc 0%, #22d3ee 100%);
            grid-column: span 8;
        }

        .loadbalancer-section {
            background: linear-gradient(135deg, #c7d2fe 0%, #818cf8 100%);
            grid-column: span 4;
        }

        .queue-service-section {
            background: linear-gradient(135deg, #d9f99d 0%, #84cc16 100%);
            grid-column: span 8;
        }

        .coordination-section {
            background: linear-gradient(135deg, #fde047 0%, #facc15 100%);
            grid-column: span 4;
        }

        .redis-section {
            background: linear-gradient(135deg, #fbcfe8 0%, #f472b6 100%);
            grid-column: span 4;
        }

        .database-section {
            background: linear-gradient(135deg, #fed7aa 0%, #fb923c 100%);
            grid-column: span 4;
        }

        .storage-section {
            background: linear-gradient(135deg, #bae6fd 0%, #38bdf8 100%);
            grid-column: span 4;
        }

        .workers-section {
            background: linear-gradient(135deg, #e9d5ff 0%, #c084fc 100%);
            grid-column: span 6;
        }

        .consumers-section {
            background: linear-gradient(135deg, #99f6e4 0%, #2dd4bf 100%);
            grid-column: span 6;
        }

        .monitoring-section {
            background: linear-gradient(135deg, #fca5a5 0%, #ef4444 100%);
            grid-column: span 6;
        }

        .dlq-section {
            background: linear-gradient(135deg, #fecaca 0%, #f87171 100%);
            grid-column: span 6;
        }

        .flow-indicator {
            font-size: 0.75em;
            color: #6366f1;
            font-weight: 600;
            margin: 10px 0;
            padding: 5px 10px;
            background: rgba(99, 102, 241, 0.1);
            border-radius: 5px;
            display: inline-block;
        }

        .key-metrics {
            background: #fef3c7;
            padding: 15px;
            border-radius: 10px;
            margin-top: 30px;
            border: 2px solid #fbbf24;
        }

        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .metric-item {
            background: white;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #6366f1;
        }

        .metric-value {
            font-size: 1.5em;
            font-weight: 700;
            color: #6366f1;
        }

        .metric-label {
            font-size: 0.9em;
            color: #4a5568;
            margin-top: 5px;
        }

        .code-snippet {
            background: #1e293b;
            color: #e2e8f0;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 0.85em;
            margin-top: 10px;
            overflow-x: auto;
        }

        .highlight {
            color: #fbbf24;
            font-weight: 600;
        }

        @media (max-width: 1400px) {
            .architecture {
                grid-template-columns: repeat(6, 1fr);
            }
            .section { grid-column: span 6 !important; }
        }

        @media (max-width: 768px) {
            .architecture {
                grid-template-columns: 1fr;
            }
            .section { grid-column: span 1 !important; }
        }
    </style>
</head>
<body>
<div class="container">
    <div class="header">
        <h1>üîÑ Distributed Priority Queue System Design Blueprint</h1>
        <div class="subtitle">Complete End-to-End Architecture</div>
        <div class="tags">
            <span class="tag throughput">High Throughput</span>
            <span class="tag consensus">Distributed Consensus</span>
            <span class="tag scale">Horizontally Scalable</span>
        </div>
    </div>

    <div class="architecture">
        <!-- Producers Layer -->
        <div class="section producers-section">
            <div class="section-title">üì§ PRODUCERS</div>
            <div class="component">
                <div class="component-name">Message Publishers</div>
                <div class="component-details">
                    <strong>Sources:</strong>
                    <ul>
                        <li>Microservices (Order Service, Payment Service)</li>
                        <li>API Endpoints (REST/GraphQL)</li>
                        <li>Background Jobs (Scheduled Tasks)</li>
                        <li>Event Streams (Kafka consumers ‚Üí Queue producers)</li>
                    </ul>
                    <strong>Capabilities:</strong>
                    <ul>
                        <li>Batch enqueue (up to 10 messages)</li>
                        <li>Idempotency keys</li>
                        <li>Priority selection (1-10)</li>
                        <li>Delay scheduling</li>
                    </ul>
                </div>
            </div>
            <div class="flow-indicator">‚Üì HTTPS/gRPC</div>
        </div>

        <!-- Gateway -->
        <div class="section gateway-section">
            <div class="section-title">üö™ API GATEWAY & EDGE</div>
            <div class="component">
                <div class="component-name">Kong / AWS API Gateway</div>
                <div class="component-details">
                    <strong>Responsibilities:</strong>
                    <ul>
                        <li><strong>Authentication:</strong> JWT, API Keys, OAuth2.0</li>
                        <li><strong>Rate Limiting:</strong> Token bucket per client
                            <div class="code-snippet">
                                Basic: 100 req/min
                                Premium: 1000 req/min
                                Enterprise: 10K req/min</div>
                        </li>
                        <li><strong>Request Validation:</strong> Schema validation, message size limits (256 KB default)</li>
                        <li><strong>Circuit Breaker:</strong> Fail fast when backend unhealthy</li>
                        <li><strong>Protocol Translation:</strong> REST ‚Üí gRPC, HTTP/2 multiplexing</li>
                        <li><strong>Metrics:</strong> Request latency, error rates, throughput</li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- Load Balancer -->
        <div class="section loadbalancer-section">
            <div class="section-title">‚öñÔ∏è LOAD BALANCING</div>
            <div class="component">
                <div class="component-name">Application Load Balancer</div>
                <div class="component-details">
                    <strong>Algorithms:</strong>
                    <ul>
                        <li><strong>Consistent Hashing:</strong> By queue_name (sticky routing)</li>
                        <li><strong>Least Connections:</strong> For optimal load distribution</li>
                        <li><strong>Round Robin:</strong> Default for stateless operations</li>
                    </ul>
                    <strong>Features:</strong>
                    <ul>
                        <li>Health checks every 10s (HTTP 200 /health)</li>
                        <li>Auto-scaling triggers (CPU > 70%)</li>
                        <li>SSL/TLS termination (TLS 1.3)</li>
                        <li>Connection draining (30s graceful shutdown)</li>
                    </ul>
                </div>
            </div>
            <div class="flow-indicator">‚Üì Route to Queue Service</div>
        </div>

        <!-- Queue Service -->
        <div class="section queue-service-section">
            <div class="section-title">üîß QUEUE SERVICE CLUSTER</div>

            <div class="component">
                <div class="component-name">Queue Service (Stateless)</div>
                <div class="component-details">
                    <strong>Technology: Go / Java Spring Boot</strong>
                    <div class="code-snippet">
                        // Enqueue API
                        POST /queues/{queue_name}/messages
                        {
                          "priority": 8,
                          "payload": {...},
                          "delay_seconds": 0,
                          "deduplication_id": "unique-key"
                        }

                        // Dequeue API
                        POST /queues/{queue_name}/dequeue
                        {
                          "max_messages": 1,
                          "visibility_timeout": 30,
                          "wait_time_seconds": 20  // Long polling
                        }</div>
                    <strong>Core Operations:</strong>
                    <ul>
                        <li><strong>Enqueue:</strong> Validate ‚Üí Store DB ‚Üí Add to Redis sorted set ‚Üí Update metrics</li>
                        <li><strong>Dequeue:</strong> Query Redis by priority ‚Üí Mark in-flight ‚Üí Set visibility timeout ‚Üí Return message</li>
                        <li><strong>Acknowledge:</strong> Delete from DB + Redis ‚Üí Update stats</li>
                        <li><strong>Change Visibility:</strong> Extend timeout for long-running tasks</li>
                    </ul>
                    <strong>Horizontal Scaling:</strong>
                    <ul>
                        <li>Replicas: 10-50 pods (Kubernetes HPA)</li>
                        <li>CPU/Memory limits: 2 CPU, 4 GB RAM per pod</li>
                        <li>Connection pooling: 100 DB connections per instance</li>
                    </ul>
                </div>
            </div>

            <div class="component">
                <div class="component-name">Priority Manager</div>
                <div class="component-details">
                    <strong>Priority Levels (1-10):</strong>
                    <ul>
                        <li><strong>Critical (10):</strong> Payment failures, fraud alerts</li>
                        <li><strong>High (7-9):</strong> Order processing, user notifications</li>
                        <li><strong>Medium (4-6):</strong> Email campaigns, analytics</li>
                        <li><strong>Low (1-3):</strong> Batch jobs, cleanup tasks</li>
                    </ul>
                    <strong>Fairness Mechanisms:</strong>
                    <ul>
                        <li>Priority boost: Low-priority messages promoted after 10 min wait</li>
                        <li>Quota-based dequeue: 70% high priority, 20% medium, 10% low</li>
                        <li>Starvation prevention: Minimum 1% processing for all priorities</li>
                    </ul>
                </div>
            </div>

            <div class="component">
                <div class="component-name">Visibility Timeout Handler</div>
                <div class="component-details">
                    <strong>Background Worker (runs every 5s):</strong>
                    <div class="code-snippet">
                        SELECT message_id, queue_name, priority
                        FROM messages
                        WHERE status = 'IN_FLIGHT'
                          AND visible_at <= NOW()
                        LIMIT 1000;

                        -- Re-enqueue expired messages
                        UPDATE messages SET status = 'READY'
                        WHERE message_id IN (...);</div>
                    <ul>
                        <li>Return timed-out messages to queue</li>
                        <li>Increment receive_count</li>
                        <li>Move to DLQ if receive_count > max_receive_count</li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- Coordination Layer -->
        <div class="section coordination-section">
            <div class="section-title">ü§ù COORDINATION</div>
            <div class="component">
                <div class="component-name">Zookeeper / etcd Cluster</div>
                <div class="component-details">
                    <strong>Use Cases:</strong>
                    <ul>
                        <li><strong>Leader Election:</strong> For queue partitions (ensures single writer)</li>
                        <li><strong>Service Discovery:</strong> Dynamic queue service registration</li>
                        <li><strong>Configuration Management:</strong> Queue settings, feature flags</li>
                        <li><strong>Distributed Locks:</strong> Critical sections (DLQ processing)</li>
                    </ul>
                    <strong>Cluster Setup:</strong>
                    <ul>
                        <li>3-5 nodes (quorum-based consensus)</li>
                        <li>Raft/Paxos algorithm for consensus</li>
                        <li>Ephemeral nodes for service health</li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- Redis Cache -->
        <div class="section redis-section">
            <div class="section-title">üíæ REDIS CLUSTER</div>
            <div class="component">
                <div class="component-name">Redis (In-Memory Hot Data)</div>
                <div class="component-details">
                    <strong>Architecture:</strong>
                    <ul>
                        <li>6 nodes: 3 masters + 3 replicas</li>
                        <li>Consistent hashing for sharding</li>
                        <li>LRU eviction policy</li>
                        <li>AOF + RDB persistence</li>
                    </ul>
                    <strong>Data Structures:</strong>
                    <div class="code-snippet">
                        # Priority Queue (Sorted Set)
                        # Score = (priority * 10^15) + timestamp
                        ZADD queue:orders:priority:10 "1699900000.123" "msg-id-1"

                        # In-flight tracker (Hash)
                        HSET inflight:msg-id-1 consumer "worker-5"
                        EXPIRE inflight:msg-id-1 60

                        # Queue stats (Hash)
                        HINCRBY queue:orders:stats enqueued 1
                        HSET queue:orders:stats oldest_message_age 127

                        # Priority bitmap (for optimization)
                        SETBIT queue:orders:priority_bitmap 10 1</div>
                    <strong>Performance:</strong>
                    <ul>
                        <li>Throughput: 100K ops/sec per node</li>
                        <li>Latency: <1ms (P99)</li>
                        <li>Memory: 64 GB per node</li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- PostgreSQL Database -->
        <div class="section database-section">
            <div class="section-title">üóÑÔ∏è POSTGRESQL</div>
            <div class="component">
                <div class="component-name">Primary + Replicas</div>
                <div class="component-details">
                    <strong>Schema Design:</strong>
                    <div class="code-snippet">
                        CREATE TABLE messages (
                          message_id UUID PRIMARY KEY,
                          queue_name VARCHAR(255) NOT NULL,
                          priority SMALLINT,
                          payload JSONB,
                          status VARCHAR(20),
                          visible_at TIMESTAMP,
                          receive_count INT
                        );

                        CREATE INDEX idx_priority
                        ON messages(queue_name, priority DESC, created_at ASC)
                        WHERE status = 'READY';</div>
                    <strong>Replication:</strong>
                    <ul>
                        <li>1 Primary (write-heavy)</li>
                        <li>2 Read Replicas (async streaming replication)</li>
                        <li>Lag monitoring: <100ms</li>
                        <li>Auto-failover with Patroni</li>
                    </ul>
                    <strong>Partitioning:</strong>
                    <ul>
                        <li>Range partitioning by priority (10-8, 7-4, 3-1)</li>
                        <li>Horizontal sharding by queue_name hash (16 shards)</li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- Object Storage -->
        <div class="section storage-section">
            <div class="section-title">‚òÅÔ∏è OBJECT STORAGE</div>
            <div class="component">
                <div class="component-name">Amazon S3 / Azure Blob</div>
                <div class="component-details">
                    <strong>Use Cases:</strong>
                    <ul>
                        <li><strong>Large Payloads:</strong> Messages > 256 KB stored in S3, reference in DB</li>
                        <li><strong>Message Archives:</strong> Move old messages (7+ days) to S3 for compliance</li>
                        <li><strong>Analytics Exports:</strong> Daily queue metrics exported to Parquet files</li>
                        <li><strong>Backups:</strong> PostgreSQL snapshots, Redis RDB files</li>
                    </ul>
                    <strong>Lifecycle Policies:</strong>
                    <div class="code-snippet">
                        messages/processed/ ‚Üí S3 Standard (30 days)
                        ‚Üí S3 IA (90 days)
                        ‚Üí S3 Glacier (2 years)
                        ‚Üí Delete (after 2 years)</div>
                    <strong>Performance:</strong>
                    <ul>
                        <li>Multipart upload for large files (>5 MB)</li>
                        <li>S3 Transfer Acceleration for global access</li>
                        <li>CloudFront CDN for frequently accessed archives</li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- Background Workers -->
        <div class="section workers-section">
            <div class="section-title">‚öôÔ∏è BACKGROUND WORKERS</div>

            <div class="component">
                <div class="component-name">Scheduled Message Processor</div>
                <div class="component-details">
                    <strong>Runs every 1 second:</strong>
                    <ul>
                        <li>Query messages with <code>scheduled_at <= NOW()</code></li>
                        <li>Move from SCHEDULED ‚Üí READY status</li>
                        <li>Add to Redis priority queue</li>
                        <li>Use distributed lock to prevent duplicates</li>
                    </ul>
                </div>
            </div>

            <div class="component">
                <div class="component-name">DLQ Monitor</div>
                <div class="component-details">
                    <strong>Runs every 5 minutes:</strong>
                    <ul>
                        <li>Check DLQ size growth rate</li>
                        <li>Alert if DLQ > 100 messages</li>
                        <li>Generate reports for failed messages</li>
                        <li>Retry with exponential backoff (optional)</li>
                    </ul>
                </div>
            </div>

            <div class="component">
                <div class="component-name">Metrics Aggregator</div>
                <div class="component-details">
                    <strong>Runs every 10 seconds:</strong>
                    <ul>
                        <li>Calculate queue depth per priority</li>
                        <li>Track oldest message age</li>
                        <li>Consumer lag metrics</li>
                        <li>Throughput (enqueue/dequeue rates)</li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- Consumers -->
        <div class="section consumers-section">
            <div class="section-title">üë∑ CONSUMERS</div>
            <div class="component">
                <div class="component-name">Worker Pools</div>
                <div class="component-details">
                    <strong>Consumer Types:</strong>
                    <ul>
                        <li><strong>Order Processors:</strong> 50 workers, priority 8-10</li>
                        <li><strong>Email Workers:</strong> 20 workers, priority 4-6</li>
                        <li><strong>Batch Job Workers:</strong> 10 workers, priority 1-3</li>
                    </ul>
                    <strong>Processing Pattern:</strong>
                    <div class="code-snippet">
                        while True:
                          msg = dequeue(queue_name, wait_time=20)
                          if msg:
                            try:
                              process(msg.payload)
                              acknowledge(msg.receipt_handle)
                            except Exception as e:
                              # Retry or let visibility timeout expire
                              change_visibility(msg, timeout=60)
                          else:
                            sleep(1)</div>
                    <strong>Auto-scaling:</strong>
                    <ul>
                        <li>Scale up: Queue depth > 1000 messages</li>
                        <li>Scale down: Queue depth < 100 messages</li>
                        <li>Kubernetes HPA based on custom metrics</li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- Monitoring -->
        <div class="section monitoring-section">
            <div class="section-title">üìà MONITORING & ALERTING</div>
            <div class="component">
                <div class="component-name">Prometheus + Grafana</div>
                <div class="component-details">
                    <strong>Key Metrics:</strong>
                    <ul>
                        <li>Queue depth (gauge): <code>queue_depth{queue="orders", priority="10"}</code></li>
                        <li>Enqueue rate (counter): <code>messages_enqueued_total</code></li>
                        <li>Dequeue rate (counter): <code>messages_dequeued_total</code></li>
                        <li>Message age (histogram): <code>message_age_seconds</code></li>
                        <li>Processing time (histogram): <code>consumer_processing_duration_ms</code></li>
                    </ul>
                </div>
            </div>

            <div class="component">
                <div class="component-name">ELK Stack (Logging)</div>
                <div class="component-details">
                    <ul>
                        <li>Centralized logging from all services</li>
                        <li>Structured JSON logs with trace IDs</li>
                        <li>7-day retention for operational logs</li>
                        <li>30-day retention for audit logs</li>
                    </ul>
                </div>
            </div>

            <div class="component">
                <div class="component-name">PagerDuty Alerts</div>
                <div class="component-details">
                    <strong>Critical Alerts:</strong>
                    <ul>
                        <li>Queue depth > 10,000 for 5 min</li>
                        <li>Oldest message age > 300 sec</li>
                        <li>DLQ size > 100</li>
                        <li>No consumers for 1 min</li>
                        <li>Error rate > 5%</li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- Dead Letter Queue -->
        <div class="section dlq-section">
            <div class="section-title">‚ò†Ô∏è DEAD LETTER QUEUE</div>
            <div class="component">
                <div class="component-name">DLQ Handler</div>
                <div class="component-details">
                    <strong>Triggers:</strong>
                    <ul>
                        <li>Message received > <code>max_receive_count</code> (default: 5)</li>
                        <li>Message expired (past TTL)</li>
                        <li>Validation failures</li>
                    </ul>
                    <strong>Processing:</strong>
                    <div class="code-snippet">
                        if message.receive_count > 5:
                          move_to_dlq(message)
                          alert_ops_team()
                          log_failure_reason()</div>
                    <strong>Manual Intervention:</strong>
                    <ul>
                        <li>Admin dashboard to view DLQ messages</li>
                        <li>Replay messages after fixing root cause</li>
                        <li>Bulk delete after investigation</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <!-- Key System Metrics -->
    <div class="key-metrics">
        <div class="section-title">üéØ KEY SYSTEM METRICS & CAPACITY PLANNING</div>
        <div class="metrics-grid">
            <div class="metric-item">
                <div class="metric-value">100K+</div>
                <div class="metric-label">Messages/sec throughput</div>
            </div>
            <div class="metric-item">
                <div class="metric-value">&lt;50ms</div>
                <div class="metric-label">P95 enqueue latency</div>
            </div>
            <div class="metric-item">
                <div class="metric-value">&lt;100ms</div>
                <div class="metric-label">P95 dequeue latency</div>
            </div>
            <div class="metric-item">
                <div class="metric-value">99.99%</div>
                <div class="metric-label">Availability SLA</div>
            </div>
            <div class="metric-item">
                <div class="metric-value">16.8 TB</div>
                <div class="metric-label">Storage (7-day retention)</div>
            </div>
            <div class="metric-item">
                <div class="metric-value">10 Priorities</div>
                <div class="metric-label">Granular priority levels</div>
            </div>
        </div>
    </div>

    <!-- Additional Details -->
    <div style="margin-top: 40px; padding: 30px; background: #f8fafc; border-radius: 15px; border: 2px solid #e2e8f0;">
        <h2 style="color: #2d3748; margin-bottom: 20px;">üîê ADDITIONAL SYSTEM CONSIDERATIONS</h2>

        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(400px, 1fr)); gap: 25px;">
            <div>
                <h3 style="color: #6366f1; margin-bottom: 10px;">Security Measures</h3>
                <ul style="line-height: 2; color: #4a5568;">
                    <li><strong>Encryption:</strong> TLS 1.3 in transit, AES-256 at rest</li>
                    <li><strong>Authentication:</strong> JWT tokens, API key rotation every 90 days</li>
                    <li><strong>Authorization:</strong> RBAC per queue (read/write/admin)</li>
                    <li><strong>Rate Limiting:</strong> Token bucket per client (1K req/min default)</li>
                    <li><strong>Audit Logging:</strong> All enqueue/dequeue operations logged</li>
                    <li><strong>Network Isolation:</strong> Private subnets, VPC peering</li>
                </ul>
            </div>

            <div>
                <h3 style="color: #6366f1; margin-bottom: 10px;">Scalability Strategies</h3>
                <ul style="line-height: 2; color: #4a5568;">
                    <li><strong>Horizontal Scaling:</strong> Auto-scale queue service pods (10-50)</li>
                    <li><strong>Database Sharding:</strong> Hash-based by queue_name (16 shards)</li>
                    <li><strong>Redis Cluster:</strong> Consistent hashing across 3 masters</li>
                    <li><strong>Consumer Auto-scaling:</strong> HPA based on queue depth</li>
                    <li><strong>Multi-region:</strong> Active-active for HA, geo-routing</li>
                    <li><strong>Partition Isolation:</strong> Separate queues by priority class</li>
                </ul>
            </div>

            <div>
                <h3 style="color: #6366f1; margin-bottom: 10px;">Data Consistency</h3>
                <ul style="line-height: 2; color: #4a5568;">
                    <li><strong>Write:</strong> Strong consistency (PostgreSQL ACID)</li>
                    <li><strong>Read:</strong> Eventual consistency (Redis cache)</li>
                    <li><strong>Deduplication:</strong> Idempotency keys (24-hour window)</li>
                    <li><strong>Ordering:</strong> FIFO within same priority guaranteed</li>
                    <li><strong>Delivery:</strong> At-least-once (exactly-once optional)</li>
                </ul>
            </div>

            <div>
                <h3 style="color: #6366f1; margin-bottom: 10px;">Failure Scenarios & Recovery</h3>
                <ul style="line-height: 2; color: #4a5568;">
                    <li><strong>Queue Service Crash:</strong> LB routes to healthy instances</li>
                    <li><strong>Redis Failure:</strong> Rebuild from PostgreSQL (5 min RTO)</li>
                    <li><strong>DB Failover:</strong> Patroni auto-promotes replica (30s RTO)</li>
                    <li><strong>Region Outage:</strong> DNS failover to backup region (5 min)</li>
                    <li><strong>Message Loss:</strong> PostgreSQL PITR, daily backups</li>
                </ul>
            </div>
        </div>
    </div>

    <!-- Tech Stack Comparison -->
    <div style="margin-top: 30px; padding: 30px; background: linear-gradient(135deg, #dbeafe 0%, #93c5fd 100%); border-radius: 15px;">
        <h2 style="color: #1e40af; margin-bottom: 20px;">üõ†Ô∏è TECHNOLOGY STACK COMPARISON</h2>
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">
            <div style="background: white; padding: 20px; border-radius: 10px; border-left: 5px solid #6366f1;">
                <h4 style="color: #6366f1; margin-bottom: 10px;">RabbitMQ</h4>
                <p style="color: #4a5568; line-height: 1.8; font-size: 0.9em;">
                    <strong>Pros:</strong> Native priority queues, AMQP protocol, rich routing<br>
                    <strong>Cons:</strong> Single point of failure, limited horizontal scale<br>
                    <strong>Best For:</strong> Enterprise messaging, complex routing needs
                </p>
            </div>

            <div style="background: white; padding: 20px; border-radius: 10px; border-left: 5px solid #10b981;">
                <h4 style="color: #10b981; margin-bottom: 10px;">Amazon SQS</h4>
                <p style="color: #4a5568; line-height: 1.8; font-size: 0.9em;">
                    <strong>Pros:</strong> Fully managed, infinite scale, AWS integration<br>
                    <strong>Cons:</strong> No strict ordering, higher latency (~100ms)<br>
                    <strong>Best For:</strong> AWS-native apps, serverless architectures
                </p>
            </div>

            <div style="background: white; padding: 20px; border-radius: 10px; border-left: 5px solid #f59e0b;">
                <h4 style="color: #f59e0b; margin-bottom: 10px;">Apache Kafka</h4>
                <p style="color: #4a5568; line-height: 1.8; font-size: 0.9em;">
                    <strong>Pros:</strong> High throughput (millions/sec), durable, distributed<br>
                    <strong>Cons:</strong> Not designed for priority, complex setup<br>
                    <strong>Best For:</strong> Event streaming, log aggregation, analytics
                </p>
            </div>

            <div style="background: white; padding: 20px; border-radius: 10px; border-left: 5px solid #ec4899;">
                <h4 style="color: #ec4899; margin-bottom: 10px;">Redis Streams</h4>
                <p style="color: #4a5568; line-height: 1.8; font-size: 0.9em;">
                    <strong>Pros:</strong> Fast (&lt;1ms), simple, consumer groups<br>
                    <strong>Cons:</strong> Limited durability, memory-bound<br>
                    <strong>Best For:</strong> Real-time processing, small-medium scale
                </p>
            </div>

            <div style="background: white; padding: 20px; border-radius: 10px; border-left: 5px solid #8b5cf6;">
                <h4 style="color: #8b5cf6; margin-bottom: 10px;">Custom Solution (This Design)</h4>
                <p style="color: #4a5568; line-height: 1.8; font-size: 0.9em;">
                    <strong>Pros:</strong> Full control, optimized for priority, cost-effective<br>
                    <strong>Cons:</strong> Maintenance overhead, operational complexity<br>
                    <strong>Best For:</strong> Specific requirements, learning, control
                </p>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <div style="text-align: center; margin-top: 40px; padding-top: 20px; border-top: 2px solid #e2e8f0; color: #718096;">
        <p style="font-size: 0.9em;">üí° <strong>Design Pattern:</strong> This architecture implements distributed consensus for ordering, CQRS for read/write separation, and event-driven processing</p>
        <p style="font-size: 0.9em; margin-top: 10px;">Built with: Go/Java ‚Ä¢ PostgreSQL ‚Ä¢ Redis ‚Ä¢ Zookeeper ‚Ä¢ Kubernetes ‚Ä¢ Prometheus</p>
    </div>
</div>
</body>
</html>
