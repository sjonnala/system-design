<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Web Crawler Architecture Flow Diagram</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            min-height: 100vh;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
            padding-bottom: 20px;
            border-bottom: 3px solid #667eea;
        }

        .header h1 {
            font-size: 2.5em;
            color: #2d3748;
            margin-bottom: 10px;
        }

        .tabs {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .tab {
            padding: 12px 24px;
            background: #e2e8f0;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 0.95em;
            font-weight: 600;
            transition: all 0.3s;
        }

        .tab.active {
            background: #6366f1;
            color: white;
        }

        .tab:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }

        .diagram-container {
            display: none;
            margin-top: 30px;
        }

        .diagram-container.active {
            display: block;
        }

        svg {
            width: 100%;
            height: auto;
        }

        .component {
            cursor: pointer;
            transition: all 0.3s;
        }

        .component:hover {
            filter: drop-shadow(0 0 10px rgba(99, 102, 241, 0.5));
        }

        .component rect {
            transition: all 0.3s;
        }

        .component:hover rect {
            stroke-width: 3;
        }

        .flow-arrow {
            animation: dash 20s linear infinite;
        }

        @keyframes dash {
            to {
                stroke-dashoffset: -1000;
            }
        }

        .legend {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin-top: 30px;
            padding: 20px;
            background: #f8fafc;
            border-radius: 10px;
            flex-wrap: wrap;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .legend-color {
            width: 30px;
            height: 30px;
            border-radius: 5px;
            border: 2px solid #cbd5e0;
        }

        .metrics-panel {
            margin-top: 30px;
            padding: 25px;
            background: linear-gradient(135deg, #fef3c7 0%, #fde047 100%);
            border-radius: 15px;
            border: 2px solid #fbbf24;
        }

        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .metric-card {
            background: white;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            border-left: 4px solid #6366f1;
        }

        .metric-value {
            font-size: 1.8em;
            font-weight: 700;
            color: #6366f1;
        }

        .metric-label {
            font-size: 0.9em;
            color: #4a5568;
            margin-top: 5px;
        }

        .flow-description {
            background: #e0e7ff;
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
            border-left: 5px solid #6366f1;
        }

        .flow-description h3 {
            color: #4338ca;
            margin-bottom: 10px;
        }

        .flow-description ol {
            margin-left: 20px;
            line-height: 2;
            color: #1e293b;
        }

        .flow-description ol li {
            margin: 8px 0;
        }

        .flow-description strong {
            color: #6366f1;
        }
    </style>
</head>
<body>
<div class="container">
    <div class="header">
        <h1>üï∑Ô∏è Web Crawler Architecture Flow Diagram</h1>
        <p style="color: #64748b; margin-top: 10px;">Interactive Component Flow Visualization</p>

        <div class="tabs">
            <button class="tab active" onclick="showDiagram('basic')">üîÑ Basic Crawl Flow</button>
            <button class="tab" onclick="showDiagram('distributed')">üåê Distributed Architecture</button>
            <button class="tab" onclick="showDiagram('politeness')">ü§ù Politeness & URL Frontier</button>
            <button class="tab" onclick="showDiagram('full')">üèóÔ∏è Complete System Flow</button>
        </div>
    </div>

    <!-- Basic Crawl Flow -->
    <div id="basic-diagram" class="diagram-container active">
        <svg viewBox="0 0 1400 1300" xmlns="http://www.w3.org/2000/svg">
            <defs>
                <marker id="arrowhead" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
                    <polygon points="0 0, 10 3, 0 6" fill="#6366f1" />
                </marker>
                <linearGradient id="grad-seed" x1="0%" y1="0%" x2="0%" y2="100%">
                    <stop offset="0%" style="stop-color:#fde047;stop-opacity:1" />
                    <stop offset="100%" style="stop-color:#facc15;stop-opacity:1" />
                </linearGradient>
                <linearGradient id="grad-frontier" x1="0%" y1="0%" x2="0%" y2="100%">
                    <stop offset="0%" style="stop-color:#60a5fa;stop-opacity:1" />
                    <stop offset="100%" style="stop-color:#3b82f6;stop-opacity:1" />
                </linearGradient>
                <linearGradient id="grad-fetcher" x1="0%" y1="0%" x2="0%" y2="100%">
                    <stop offset="0%" style="stop-color:#22d3ee;stop-opacity:1" />
                    <stop offset="100%" style="stop-color:#06b6d4;stop-opacity:1" />
                </linearGradient>
                <linearGradient id="grad-parser" x1="0%" y1="0%" x2="0%" y2="100%">
                    <stop offset="0%" style="stop-color:#84cc16;stop-opacity:1" />
                    <stop offset="100%" style="stop-color:#65a30d;stop-opacity:1" />
                </linearGradient>
                <linearGradient id="grad-dedup" x1="0%" y1="0%" x2="0%" y2="100%">
                    <stop offset="0%" style="stop-color:#f87171;stop-opacity:1" />
                    <stop offset="100%" style="stop-color:#ef4444;stop-opacity:1" />
                </linearGradient>
                <linearGradient id="grad-storage" x1="0%" y1="0%" x2="0%" y2="100%">
                    <stop offset="0%" style="stop-color:#fb923c;stop-opacity:1" />
                    <stop offset="100%" style="stop-color:#f97316;stop-opacity:1" />
                </linearGradient>
                <linearGradient id="grad-index" x1="0%" y1="0%" x2="0%" y2="100%">
                    <stop offset="0%" style="stop-color:#c084fc;stop-opacity:1" />
                    <stop offset="100%" style="stop-color:#a855f7;stop-opacity:1" />
                </linearGradient>
            </defs>

            <!-- Title -->
            <text x="700" y="30" font-size="24" font-weight="bold" text-anchor="middle" fill="#2d3748">
                Basic Web Crawling Flow
            </text>

            <!-- Step 1: Seed URLs -->
            <g class="component">
                <rect x="550" y="70" width="300" height="90" rx="10" fill="url(#grad-seed)" stroke="#ca8a04" stroke-width="2"/>
                <text x="700" y="105" font-size="16" font-weight="bold" text-anchor="middle" fill="white">üå± Seed URLs</text>
                <text x="700" y="130" font-size="12" text-anchor="middle" fill="white">Initial URL list</text>
                <text x="700" y="145" font-size="11" text-anchor="middle" fill="white">["https://example.com", ...]</text>
            </g>
            <circle cx="700" cy="115" r="22" fill="#fbbf24" stroke="#f59e0b" stroke-width="2"/>
            <text x="700" y="123" font-size="16" font-weight="bold" text-anchor="middle" fill="white">1</text>

            <!-- Arrow -->
            <path d="M 700 160 L 700 210" stroke="#6366f1" stroke-width="3" fill="none" marker-end="url(#arrowhead)" class="flow-arrow" stroke-dasharray="5,5"/>
            <text x="720" y="190" font-size="11" fill="#4338ca" font-weight="600">Add to queue</text>

            <!-- Step 2: URL Frontier -->
            <g class="component">
                <rect x="550" y="210" width="300" height="90" rx="10" fill="url(#grad-frontier)" stroke="#2563eb" stroke-width="2"/>
                <text x="700" y="245" font-size="16" font-weight="bold" text-anchor="middle" fill="white">üö™ URL Frontier</text>
                <text x="700" y="270" font-size="12" text-anchor="middle" fill="white">Priority Queue</text>
                <text x="700" y="285" font-size="11" text-anchor="middle" fill="white">Politeness enforcement</text>
            </g>
            <circle cx="700" cy="255" r="22" fill="#fbbf24" stroke="#f59e0b" stroke-width="2"/>
            <text x="700" y="263" font-size="16" font-weight="bold" text-anchor="middle" fill="white">2</text>

            <!-- Arrow -->
            <path d="M 700 300 L 700 350" stroke="#6366f1" stroke-width="3" fill="none" marker-end="url(#arrowhead)" class="flow-arrow" stroke-dasharray="5,5"/>
            <text x="720" y="330" font-size="11" fill="#4338ca" font-weight="600">Select URL</text>

            <!-- Step 3: URL Fetcher -->
            <g class="component">
                <rect x="550" y="350" width="300" height="110" rx="10" fill="url(#grad-fetcher)" stroke="#0891b2" stroke-width="2"/>
                <text x="700" y="390" font-size="16" font-weight="bold" text-anchor="middle" fill="white">üì• HTTP Fetcher</text>
                <text x="700" y="415" font-size="12" text-anchor="middle" fill="white">1. Check robots.txt</text>
                <text x="700" y="435" font-size="12" text-anchor="middle" fill="white">2. DNS lookup</text>
                <text x="700" y="455" font-size="12" text-anchor="middle" fill="white">3. HTTP GET request</text>
            </g>
            <circle cx="700" cy="405" r="22" fill="#fbbf24" stroke="#f59e0b" stroke-width="2"/>
            <text x="700" y="413" font-size="16" font-weight="bold" text-anchor="middle" fill="white">3</text>

            <!-- Arrow -->
            <path d="M 700 460 L 700 510" stroke="#6366f1" stroke-width="3" fill="none" marker-end="url(#arrowhead)" class="flow-arrow" stroke-dasharray="5,5"/>
            <text x="720" y="490" font-size="11" fill="#4338ca" font-weight="600">HTML response</text>

            <!-- Step 4: Content Parser -->
            <g class="component">
                <rect x="550" y="510" width="300" height="110" rx="10" fill="url(#grad-parser)" stroke="#4d7c0f" stroke-width="2"/>
                <text x="700" y="550" font-size="16" font-weight="bold" text-anchor="middle" fill="white">üìÑ Content Parser</text>
                <text x="700" y="575" font-size="12" text-anchor="middle" fill="white">1. Extract text content</text>
                <text x="700" y="595" font-size="12" text-anchor="middle" fill="white">2. Extract all links</text>
                <text x="700" y="615" font-size="12" text-anchor="middle" fill="white">3. Extract metadata</text>
            </g>
            <circle cx="700" cy="565" r="22" fill="#fbbf24" stroke="#f59e0b" stroke-width="2"/>
            <text x="700" y="573" font-size="16" font-weight="bold" text-anchor="middle" fill="white">4</text>

            <!-- Arrow to Dedup -->
            <path d="M 700 620 L 700 680" stroke="#6366f1" stroke-width="3" fill="none" marker-end="url(#arrowhead)" class="flow-arrow" stroke-dasharray="5,5"/>
            <text x="720" y="655" font-size="11" fill="#4338ca" font-weight="600">Discovered links</text>

            <!-- Step 5: URL Deduplication -->
            <g class="component">
                <rect x="550" y="680" width="300" height="100" rx="10" fill="url(#grad-dedup)" stroke="#dc2626" stroke-width="2"/>
                <text x="700" y="715" font-size="16" font-weight="bold" text-anchor="middle" fill="white">üîç URL Deduplication</text>
                <text x="700" y="740" font-size="12" text-anchor="middle" fill="white">Bloom filter + Hash table</text>
                <text x="700" y="760" font-size="11" text-anchor="middle" fill="white">Filter already seen URLs</text>
            </g>
            <circle cx="700" cy="730" r="22" fill="#fbbf24" stroke="#f59e0b" stroke-width="2"/>
            <text x="700" y="738" font-size="16" font-weight="bold" text-anchor="middle" fill="white">5</text>

            <!-- Decision Diamond -->
            <g class="component">
                <path d="M 700 820 L 800 880 L 700 940 L 600 880 Z" fill="#fef3c7" stroke="#f59e0b" stroke-width="3"/>
                <text x="700" y="875" font-size="13" font-weight="bold" text-anchor="middle" fill="#92400e">Already</text>
                <text x="700" y="893" font-size="13" font-weight="bold" text-anchor="middle" fill="#92400e">Seen?</text>
            </g>

            <!-- YES path (Skip) -->
            <path d="M 800 880 L 1000 880" stroke="#ef4444" stroke-width="4" fill="none" marker-end="url(#arrowhead)"/>
            <text x="870" y="870" font-size="12" fill="#dc2626" font-weight="700">YES</text>
            <g class="component">
                <rect x="1000" y="840" width="150" height="80" rx="10" fill="#fee2e2" stroke="#dc2626" stroke-width="3"/>
                <text x="1075" y="875" font-size="14" font-weight="bold" text-anchor="middle" fill="#991b1b">‚ùå Discard</text>
                <text x="1075" y="895" font-size="11" text-anchor="middle" fill="#991b1b">URL already crawled</text>
            </g>

            <!-- NO path (Continue) -->
            <path d="M 700 940 L 700 990" stroke="#10b981" stroke-width="4" fill="none" marker-end="url(#arrowhead)"/>
            <text x="640" y="970" font-size="12" fill="#059669" font-weight="700">NO (New URL)</text>

            <!-- Add to Frontier (Loop back) -->
            <g class="component">
                <rect x="550" y="990" width="300" height="80" rx="10" fill="#d1fae5" stroke="#10b981" stroke-width="3"/>
                <text x="700" y="1020" font-size="14" font-weight="bold" text-anchor="middle" fill="#065f46">‚ûï Add to URL Frontier</text>
                <text x="700" y="1045" font-size="11" text-anchor="middle" fill="#065f46">Queue for future crawling</text>
            </g>
            <circle cx="700" cy="1030" r="22" fill="#fbbf24" stroke="#f59e0b" stroke-width="2"/>
            <text x="700" y="1038" font-size="16" font-weight="bold" text-anchor="middle" fill="white">6</text>

            <!-- Loop back arrow -->
            <path d="M 550 1030 L 200 1030 L 200 255 L 550 255" stroke="#10b981" stroke-width="4" fill="none" marker-end="url(#arrowhead)" stroke-dasharray="8,4"/>
            <text x="120" y="640" font-size="12" fill="#059669" font-weight="700" transform="rotate(-90 120 640)">Continuous Loop</text>

            <!-- Storage path (from parser) -->
            <path d="M 850 565 L 1050 565" stroke="#6366f1" stroke-width="3" fill="none" marker-end="url(#arrowhead)" stroke-dasharray="5,5"/>
            <text x="920" y="555" font-size="11" fill="#4338ca" font-weight="600">Store content</text>

            <!-- Step 7: Content Storage -->
            <g class="component">
                <rect x="1050" y="510" width="250" height="110" rx="10" fill="url(#grad-storage)" stroke="#ea580c" stroke-width="2"/>
                <text x="1175" y="550" font-size="16" font-weight="bold" text-anchor="middle" fill="white">üíæ Content Storage</text>
                <text x="1175" y="575" font-size="12" text-anchor="middle" fill="white">Store HTML, text, metadata</text>
                <text x="1175" y="595" font-size="11" text-anchor="middle" fill="white">S3 / Distributed File System</text>
            </g>
            <circle cx="1175" cy="565" r="22" fill="#fbbf24" stroke="#f59e0b" stroke-width="2"/>
            <text x="1175" y="573" font-size="16" font-weight="bold" text-anchor="middle" fill="white">7</text>

            <!-- Arrow to Index -->
            <path d="M 1175 620 L 1175 680" stroke="#6366f1" stroke-width="3" fill="none" marker-end="url(#arrowhead)" stroke-dasharray="5,5"/>
            <text x="1195" y="655" font-size="11" fill="#4338ca" font-weight="600">Index text</text>

            <!-- Step 8: Search Index -->
            <g class="component">
                <rect x="1050" y="680" width="250" height="100" rx="10" fill="url(#grad-index)" stroke="#9333ea" stroke-width="2"/>
                <text x="1175" y="715" font-size="16" font-weight="bold" text-anchor="middle" fill="white">üîé Search Index</text>
                <text x="1175" y="740" font-size="12" text-anchor="middle" fill="white">Build inverted index</text>
                <text x="1175" y="760" font-size="11" text-anchor="middle" fill="white">Elasticsearch / Solr</text>
            </g>
            <circle cx="1175" cy="730" r="22" fill="#fbbf24" stroke="#f59e0b" stroke-width="2"/>
            <text x="1175" y="738" font-size="16" font-weight="bold" text-anchor="middle" fill="white">8</text>

        </svg>

        <div class="flow-description">
            <h3>üîÑ Basic Web Crawling Flow</h3>
            <ol>
                <li><strong>Seed URLs:</strong> Start with initial list of URLs (popular sites, sitemaps, user submissions)</li>
                <li><strong>URL Frontier:</strong> Priority queue manages URLs to crawl, enforces politeness (rate limiting per domain)</li>
                <li><strong>HTTP Fetcher:</strong>
                    <ul style="margin-left: 20px; margin-top: 5px;">
                        <li>Check robots.txt for crawl permissions</li>
                        <li>Perform DNS lookup (cached for efficiency)</li>
                        <li>Send HTTP GET request with proper User-Agent</li>
                    </ul>
                </li>
                <li><strong>Content Parser:</strong> Parse HTML to extract text, links, and metadata (title, description, etc.)</li>
                <li><strong>URL Deduplication:</strong> Use Bloom filter for fast lookup + hash table for exact matches to filter already-seen URLs</li>
                <li><strong>Decision Point:</strong> If URL already seen ‚Üí discard; if new ‚Üí add to frontier for future crawling</li>
                <li><strong>Content Storage:</strong> Store fetched content (HTML, text, metadata) in distributed storage (S3, HDFS)</li>
                <li><strong>Search Index:</strong> Build inverted index for search queries (term ‚Üí document mappings)</li>
            </ol>
            <div style="margin-top: 15px; padding: 15px; background: #fef3c7; border-left: 4px solid #f59e0b; border-radius: 5px;">
                <strong>üîÅ Continuous Loop:</strong> New URLs discovered during parsing are added back to the frontier, creating a continuous crawl loop!
            </div>
        </div>
    </div>

    <!-- Distributed Architecture -->
    <div id="distributed-diagram" class="diagram-container">
        <svg viewBox="0 0 1600 1200" xmlns="http://www.w3.org/2000/svg">
            <!-- Title -->
            <text x="800" y="35" font-size="28" font-weight="bold" text-anchor="middle" fill="#2d3748">
                Distributed Web Crawler Architecture
            </text>

            <!-- Master Coordinator -->
            <g class="component">
                <rect x="650" y="80" width="300" height="100" rx="10" fill="#c7d2fe" stroke="#6366f1" stroke-width="3"/>
                <text x="800" y="120" font-size="18" font-weight="bold" text-anchor="middle" fill="#4338ca">‚öôÔ∏è Master Coordinator</text>
                <text x="800" y="145" font-size="12" text-anchor="middle" fill="#4338ca">‚Ä¢ URL distribution</text>
                <text x="800" y="165" font-size="12" text-anchor="middle" fill="#4338ca">‚Ä¢ Worker health monitoring</text>
            </g>

            <!-- Arrows to workers -->
            <path d="M 750 180 L 400 280" stroke="#6366f1" stroke-width="3" fill="none" marker-end="url(#arrowhead)"/>
            <path d="M 800 180 L 800 280" stroke="#6366f1" stroke-width="3" fill="none" marker-end="url(#arrowhead)"/>
            <path d="M 850 180 L 1200 280" stroke="#6366f1" stroke-width="3" fill="none" marker-end="url(#arrowhead)"/>

            <!-- Worker 1 -->
            <g class="component">
                <rect x="250" y="280" width="300" height="150" rx="10" fill="#bfdbfe" stroke="#3b82f6" stroke-width="2"/>
                <text x="400" y="315" font-size="16" font-weight="bold" text-anchor="middle" fill="#1e40af">üîß Crawler Worker 1</text>
                <text x="400" y="340" font-size="11" text-anchor="middle" fill="#1e40af">Region: US-East</text>
                <rect x="270" y="355" width="260" height="60" rx="5" fill="white" stroke="#3b82f6" stroke-width="1"/>
                <text x="400" y="375" font-size="10" text-anchor="middle" fill="#1e40af">Domains: a-g.com</text>
                <text x="400" y="390" font-size="10" text-anchor="middle" fill="#1e40af">‚Ä¢ Fetcher threads: 50</text>
                <text x="400" y="405" font-size="10" text-anchor="middle" fill="#1e40af">‚Ä¢ Rate: 500 pages/sec</text>
            </g>

            <!-- Worker 2 -->
            <g class="component">
                <rect x="650" y="280" width="300" height="150" rx="10" fill="#bfdbfe" stroke="#3b82f6" stroke-width="2"/>
                <text x="800" y="315" font-size="16" font-weight="bold" text-anchor="middle" fill="#1e40af">üîß Crawler Worker 2</text>
                <text x="800" y="340" font-size="11" text-anchor="middle" fill="#1e40af">Region: US-West</text>
                <rect x="670" y="355" width="260" height="60" rx="5" fill="white" stroke="#3b82f6" stroke-width="1"/>
                <text x="800" y="375" font-size="10" text-anchor="middle" fill="#1e40af">Domains: h-n.com</text>
                <text x="800" y="390" font-size="10" text-anchor="middle" fill="#1e40af">‚Ä¢ Fetcher threads: 50</text>
                <text x="800" y="405" font-size="10" text-anchor="middle" fill="#1e40af">‚Ä¢ Rate: 500 pages/sec</text>
            </g>

            <!-- Worker N -->
            <g class="component">
                <rect x="1050" y="280" width="300" height="150" rx="10" fill="#bfdbfe" stroke="#3b82f6" stroke-width="2"/>
                <text x="1200" y="315" font-size="16" font-weight="bold" text-anchor="middle" fill="#1e40af">üîß Crawler Worker N</text>
                <text x="1200" y="340" font-size="11" text-anchor="middle" fill="#1e40af">Region: EU-West</text>
                <rect x="1070" y="355" width="260" height="60" rx="5" fill="white" stroke="#3b82f6" stroke-width="1"/>
                <text x="1200" y="375" font-size="10" text-anchor="middle" fill="#1e40af">Domains: o-z.com</text>
                <text x="1200" y="390" font-size="10" text-anchor="middle" fill="#1e40af">‚Ä¢ Fetcher threads: 50</text>
                <text x="1200" y="405" font-size="10" text-anchor="middle" fill="#1e40af">‚Ä¢ Rate: 500 pages/sec</text>
            </g>

            <!-- Arrows to shared services -->
            <path d="M 400 430 L 400 550" stroke="#6366f1" stroke-width="2" fill="none" marker-end="url(#arrowhead)"/>
            <path d="M 800 430 L 800 550" stroke="#6366f1" stroke-width="2" fill="none" marker-end="url(#arrowhead)"/>
            <path d="M 1200 430 L 1200 550" stroke="#6366f1" stroke-width="2" fill="none" marker-end="url(#arrowhead)"/>

            <!-- Shared Services Layer -->
            <text x="800" y="530" font-size="18" font-weight="bold" text-anchor="middle" fill="#64748b">Shared Services</text>

            <!-- Distributed Queue -->
            <g class="component">
                <rect x="250" y="550" width="280" height="110" rx="10" fill="#fca5a5" stroke="#ef4444" stroke-width="2"/>
                <text x="390" y="585" font-size="15" font-weight="bold" text-anchor="middle" fill="white">üì¨ Kafka Cluster</text>
                <text x="390" y="610" font-size="11" text-anchor="middle" fill="white">Topic partitions by domain</text>
                <text x="390" y="630" font-size="10" text-anchor="middle" fill="white">‚Ä¢ url.frontier (100 partitions)</text>
                <text x="390" y="645" font-size="10" text-anchor="middle" fill="white">‚Ä¢ page.fetched (50 partitions)</text>
            </g>

            <!-- Distributed Cache -->
            <g class="component">
                <rect x="580" y="550" width="280" height="110" rx="10" fill="#fbcfe8" stroke="#f472b6" stroke-width="2"/>
                <text x="720" y="585" font-size="15" font-weight="bold" text-anchor="middle" fill="white">üíæ Redis Cluster</text>
                <text x="720" y="610" font-size="11" text-anchor="middle" fill="white">Distributed deduplication</text>
                <text x="720" y="630" font-size="10" text-anchor="middle" fill="white">‚Ä¢ URL bloom filters</text>
                <text x="720" y="645" font-size="10" text-anchor="middle" fill="white">‚Ä¢ robots.txt cache</text>
            </g>

            <!-- Distributed Storage -->
            <g class="component">
                <rect x="910" y="550" width="280" height="110" rx="10" fill="#fed7aa" stroke="#fb923c" stroke-width="2"/>
                <text x="1050" y="585" font-size="15" font-weight="bold" text-anchor="middle" fill="white">üóÑÔ∏è Storage Cluster</text>
                <text x="1050" y="610" font-size="11" text-anchor="middle" fill="white">Sharded content storage</text>
                <text x="1050" y="630" font-size="10" text-anchor="middle" fill="white">‚Ä¢ S3 / HDFS</text>
                <text x="1050" y="645" font-size="10" text-anchor="middle" fill="white">‚Ä¢ Partitioned by domain</text>
            </g>

            <!-- Arrow to Database -->
            <path d="M 800 660 L 800 750" stroke="#6366f1" stroke-width="3" fill="none" marker-end="url(#arrowhead)"/>

            <!-- Distributed Database -->
            <g class="component">
                <rect x="550" y="750" width="500" height="120" rx="10" fill="#d9f99d" stroke="#84cc16" stroke-width="3"/>
                <text x="800" y="790" font-size="18" font-weight="bold" text-anchor="middle" fill="#365314">üóÉÔ∏è Distributed Database Cluster</text>
                <text x="800" y="820" font-size="12" text-anchor="middle" fill="#365314">PostgreSQL / Cassandra (Sharded)</text>
                <text x="800" y="845" font-size="11" text-anchor="middle" fill="#365314">‚Ä¢ URL metadata (crawl status, timestamps)</text>
                <text x="800" y="860" font-size="11" text-anchor="middle" fill="#365314">‚Ä¢ Sharding by URL hash</text>
            </g>

            <!-- Analytics -->
            <g class="component">
                <rect x="300" y="920" width="450" height="100" rx="10" fill="#e9d5ff" stroke="#c084fc" stroke-width="2"/>
                <text x="525" y="960" font-size="16" font-weight="bold" text-anchor="middle" fill="#6b21a8">üìä Analytics & Monitoring</text>
                <text x="525" y="985" font-size="11" text-anchor="middle" fill="#6b21a8">Prometheus ‚Ä¢ Grafana ‚Ä¢ ELK Stack</text>
                <text x="525" y="1005" font-size="10" text-anchor="middle" fill="#6b21a8">Track: Crawl rate, worker health, queue depth</text>
            </g>

            <!-- Indexing Service -->
            <g class="component">
                <rect x="800" y="920" width="450" height="100" rx="10" fill="#bae6fd" stroke="#38bdf8" stroke-width="2"/>
                <text x="1025" y="960" font-size="16" font-weight="bold" text-anchor="middle" fill="#075985">üîç Indexing Service</text>
                <text x="1025" y="985" font-size="11" text-anchor="middle" fill="#075985">Elasticsearch Cluster</text>
                <text x="1025" y="1005" font-size="10" text-anchor="middle" fill="#075985">Real-time search index building</text>
            </g>

            <!-- Arrows to services -->
            <path d="M 800 870 L 525 920" stroke="#6366f1" stroke-width="2" fill="none" marker-end="url(#arrowhead)" stroke-dasharray="5,5"/>
            <path d="M 800 870 L 1025 920" stroke="#6366f1" stroke-width="2" fill="none" marker-end="url(#arrowhead)" stroke-dasharray="5,5"/>

            <!-- Scaling info box -->
            <rect x="200" y="1070" width="1200" height="100" rx="10" fill="#fef3c7" stroke="#f59e0b" stroke-width="2"/>
            <text x="800" y="1100" font-size="16" font-weight="bold" text-anchor="middle" fill="#92400e">‚ö° Horizontal Scaling</text>
            <text x="800" y="1125" font-size="12" text-anchor="middle" fill="#92400e">Add more crawler workers to increase throughput ‚Ä¢ Each worker handles specific domain range</text>
            <text x="800" y="1145" font-size="12" text-anchor="middle" fill="#92400e">100 workers √ó 500 pages/sec = 50,000 pages/sec total throughput</text>
        </svg>

        <div class="flow-description">
            <h3>üåê Distributed Crawler Architecture</h3>
            <p style="margin-bottom: 15px; line-height: 1.8;">
                A production web crawler requires <strong>massive horizontal scaling</strong>. This architecture shows how to distribute the workload across multiple machines.
            </p>
            <h4 style="color: #6366f1; margin-top: 15px;">Key Components:</h4>
            <ul style="margin-left: 20px; line-height: 2;">
                <li><strong>Master Coordinator:</strong> Distributes URL ranges to workers, monitors health, handles failover</li>
                <li><strong>Crawler Workers:</strong> Independent processes that fetch, parse, and process pages for assigned domains</li>
                <li><strong>Kafka Cluster:</strong> Distributed message queue for URL frontier and page processing pipeline</li>
                <li><strong>Redis Cluster:</strong> Distributed cache for deduplication and robots.txt</li>
                <li><strong>Storage Cluster:</strong> S3 or HDFS for storing billions of pages</li>
                <li><strong>Database Cluster:</strong> Sharded PostgreSQL/Cassandra for URL metadata</li>
            </ul>
            <h4 style="color: #10b981; margin-top: 15px;">Scaling Strategy:</h4>
            <div style="background: #d1fae5; padding: 15px; border-radius: 5px; margin-top: 10px; border-left: 4px solid #10b981;">
                <strong>Domain-based Partitioning:</strong> Each worker is responsible for specific domains (A-G, H-N, etc.) ensuring politeness is maintained per domain while maximizing parallelism across different domains.
            </div>
        </div>
    </div>

    <!-- Politeness & URL Frontier -->
    <div id="politeness-diagram" class="diagram-container">
        <svg viewBox="0 0 1400 1100" xmlns="http://www.w3.org/2000/svg">
            <!-- Title -->
            <text x="700" y="35" font-size="26" font-weight="bold" text-anchor="middle" fill="#2d3748">
                URL Frontier & Politeness Architecture
            </text>

            <!-- Incoming URLs -->
            <g class="component">
                <rect x="550" y="80" width="300" height="80" rx="10" fill="#fde047" stroke="#facc15" stroke-width="2"/>
                <text x="700" y="115" font-size="16" font-weight="bold" text-anchor="middle" fill="#854d0e">üì• Incoming URLs</text>
                <text x="700" y="140" font-size="11" text-anchor="middle" fill="#854d0e">From parser (discovered links)</text>
            </g>

            <!-- Arrow -->
            <path d="M 700 160 L 700 220" stroke="#6366f1" stroke-width="3" fill="none" marker-end="url(#arrowhead)"/>

            <!-- Prioritizer -->
            <g class="component">
                <rect x="550" y="220" width="300" height="100" rx="10" fill="#c7d2fe" stroke="#6366f1" stroke-width="2"/>
                <text x="700" y="260" font-size="16" font-weight="bold" text-anchor="middle" fill="#4338ca">‚öñÔ∏è Prioritizer</text>
                <text x="700" y="285" font-size="11" text-anchor="middle" fill="#4338ca">Assigns priority score:</text>
                <text x="700" y="305" font-size="10" text-anchor="middle" fill="#4338ca">PageRank √ó Freshness √ó Domain Authority</text>
            </g>

            <!-- Arrows to front queues -->
            <path d="M 600 320 L 300 400" stroke="#6366f1" stroke-width="2" fill="none" marker-end="url(#arrowhead)"/>
            <path d="M 650 320 L 550 400" stroke="#6366f1" stroke-width="2" fill="none" marker-end="url(#arrowhead)"/>
            <path d="M 700 320 L 700 400" stroke="#6366f1" stroke-width="2" fill="none" marker-end="url(#arrowhead)"/>
            <path d="M 750 320 L 850 400" stroke="#6366f1" stroke-width="2" fill="none" marker-end="url(#arrowhead)"/>
            <path d="M 800 320 L 1100 400" stroke="#6366f1" stroke-width="2" fill="none" marker-end="url(#arrowhead)"/>

            <!-- Front Queues (Priority-based) -->
            <text x="700" y="390" font-size="14" font-weight="bold" text-anchor="middle" fill="#64748b">Front Queues (Priority)</text>

            <g class="component">
                <rect x="200" y="400" width="150" height="80" rx="8" fill="#fee2e2" stroke="#dc2626" stroke-width="2"/>
                <text x="275" y="430" font-size="13" font-weight="bold" text-anchor="middle" fill="#991b1b">F1: Urgent</text>
                <text x="275" y="450" font-size="10" text-anchor="middle" fill="#991b1b">News, trending</text>
                <text x="275" y="465" font-size="10" text-anchor="middle" fill="#991b1b">Priority: 9-10</text>
            </g>

            <g class="component">
                <rect x="400" y="400" width="150" height="80" rx="8" fill="#fed7aa" stroke="#f97316" stroke-width="2"/>
                <text x="475" y="430" font-size="13" font-weight="bold" text-anchor="middle" fill="#9a3412">F2: High</text>
                <text x="475" y="450" font-size="10" text-anchor="middle" fill="#9a3412">Popular sites</text>
                <text x="475" y="465" font-size="10" text-anchor="middle" fill="#9a3412">Priority: 7-8</text>
            </g>

            <g class="component">
                <rect x="600" y="400" width="150" height="80" rx="8" fill="#fef3c7" stroke="#facc15" stroke-width="2"/>
                <text x="675" y="430" font-size="13" font-weight="bold" text-anchor="middle" fill="#854d0e">F3: Medium</text>
                <text x="675" y="450" font-size="10" text-anchor="middle" fill="#854d0e">Regular sites</text>
                <text x="675" y="465" font-size="10" text-anchor="middle" fill="#854d0e">Priority: 4-6</text>
            </g>

            <g class="component">
                <rect x="800" y="400" width="150" height="80" rx="8" fill="#dbeafe" stroke="#3b82f6" stroke-width="2"/>
                <text x="875" y="430" font-size="13" font-weight="bold" text-anchor="middle" fill="#1e40af">F4: Low</text>
                <text x="875" y="450" font-size="10" text-anchor="middle" fill="#1e40af">Deep pages</text>
                <text x="875" y="465" font-size="10" text-anchor="middle" fill="#1e40af">Priority: 1-3</text>
            </g>

            <g class="component">
                <rect x="1000" y="400" width="150" height="80" rx="8" fill="#e0e7ff" stroke="#818cf8" stroke-width="2"/>
                <text x="1075" y="430" font-size="13" font-weight="bold" text-anchor="middle" fill="#4338ca">F5: Archive</text>
                <text x="1075" y="450" font-size="10" text-anchor="middle" fill="#4338ca">Old content</text>
                <text x="1075" y="465" font-size="10" text-anchor="middle" fill="#4338ca">Priority: 0</text>
            </g>

            <!-- Arrow down -->
            <path d="M 700 480 L 700 550" stroke="#6366f1" stroke-width="3" fill="none" marker-end="url(#arrowhead)"/>
            <text x="720" y="520" font-size="12" fill="#4338ca" font-weight="600">Round-robin selection</text>

            <!-- Biased Front Queue Selector -->
            <g class="component">
                <rect x="550" y="550" width="300" height="80" rx="10" fill="#c7d2fe" stroke="#6366f1" stroke-width="2"/>
                <text x="700" y="585" font-size="15" font-weight="bold" text-anchor="middle" fill="#4338ca">üé≤ Front Queue Selector</text>
                <text x="700" y="610" font-size="10" text-anchor="middle" fill="#4338ca">Biased selection: F1(40%), F2(30%), F3(20%), F4(7%), F5(3%)</text>
            </g>

            <!-- Arrow to back queues -->
            <path d="M 700 630 L 700 700" stroke="#6366f1" stroke-width="3" fill="none" marker-end="url(#arrowhead)"/>

            <!-- Back Queues (Domain-based for politeness) -->
            <text x="700" y="690" font-size="14" font-weight="bold" text-anchor="middle" fill="#64748b">Back Queues (Domain-based Politeness)</text>

            <g class="component">
                <rect x="200" y="700" width="180" height="120" rx="8" fill="#d1fae5" stroke="#10b981" stroke-width="2"/>
                <text x="290" y="730" font-size="13" font-weight="bold" text-anchor="middle" fill="#065f46">B1: example.com</text>
                <text x="290" y="755" font-size="10" text-anchor="middle" fill="#065f46">Rate: 1 req/sec</text>
                <text x="290" y="775" font-size="10" text-anchor="middle" fill="#065f46">Last fetch: 0.8s ago</text>
                <rect x="220" y="785" width="140" height="20" rx="3" fill="#10b981"/>
                <text x="290" y="799" font-size="9" text-anchor="middle" fill="white">Ready to fetch ‚úì</text>
            </g>

            <g class="component">
                <rect x="430" y="700" width="180" height="120" rx="8" fill="#fef3c7" stroke="#facc15" stroke-width="2"/>
                <text x="520" y="730" font-size="13" font-weight="bold" text-anchor="middle" fill="#854d0e">B2: news.com</text>
                <text x="520" y="755" font-size="10" text-anchor="middle" fill="#854d0e">Rate: 2 req/sec</text>
                <text x="520" y="775" font-size="10" text-anchor="middle" fill="#854d0e">Last fetch: 0.3s ago</text>
                <rect x="450" y="785" width="140" height="20" rx="3" fill="#ef4444"/>
                <text x="520" y="799" font-size="9" text-anchor="middle" fill="white">Waiting... ‚è≥</text>
            </g>

            <g class="component">
                <rect x="660" y="700" width="180" height="120" rx="8" fill="#d1fae5" stroke="#10b981" stroke-width="2"/>
                <text x="750" y="730" font-size="13" font-weight="bold" text-anchor="middle" fill="#065f46">B3: blog.org</text>
                <text x="750" y="755" font-size="10" text-anchor="middle" fill="#065f46">Rate: 0.5 req/sec</text>
                <text x="750" y="775" font-size="10" text-anchor="middle" fill="#065f46">Last fetch: 2.1s ago</text>
                <rect x="680" y="785" width="140" height="20" rx="3" fill="#10b981"/>
                <text x="750" y="799" font-size="9" text-anchor="middle" fill="white">Ready to fetch ‚úì</text>
            </g>

            <g class="component">
                <rect x="890" y="700" width="180" height="120" rx="8" fill="#d1fae5" stroke="#10b981" stroke-width="2"/>
                <text x="980" y="730" font-size="13" font-weight="bold" text-anchor="middle" fill="#065f46">Bn: domain-n.com</text>
                <text x="980" y="755" font-size="10" text-anchor="middle" fill="#065f46">Rate: 1 req/sec</text>
                <text x="980" y="775" font-size="10" text-anchor="middle" fill="#065f46">Last fetch: 1.5s ago</text>
                <rect x="910" y="785" width="140" height="20" rx="3" fill="#10b981"/>
                <text x="980" y="799" font-size="9" text-anchor="middle" fill="white">Ready to fetch ‚úì</text>
            </g>

            <!-- Back Queue Router -->
            <g class="component">
                <rect x="550" y="870" width="300" height="80" rx="10" fill="#c7d2fe" stroke="#6366f1" stroke-width="2"/>
                <text x="700" y="905" font-size="15" font-weight="bold" text-anchor="middle" fill="#4338ca">üîÄ Back Queue Router</text>
                <text x="700" y="930" font-size="10" text-anchor="middle" fill="#4338ca">Route URL to domain-specific queue: hash(domain) % N</text>
            </g>

            <!-- Arrow to fetcher -->
            <path d="M 700 950 L 700 1000" stroke="#6366f1" stroke-width="3" fill="none" marker-end="url(#arrowhead)"/>

            <!-- Fetcher -->
            <g class="component">
                <rect x="550" y="1000" width="300" height="70" rx="10" fill="#22d3ee" stroke="#06b6d4" stroke-width="2"/>
                <text x="700" y="1030" font-size="16" font-weight="bold" text-anchor="middle" fill="white">üì• HTTP Fetcher</text>
                <text x="700" y="1050" font-size="11" text-anchor="middle" fill="white">Fetch URL from ready back queue</text>
            </g>

        </svg>

        <div class="flow-description">
            <h3>ü§ù URL Frontier: Balancing Priority & Politeness</h3>
            <p style="margin-bottom: 15px; line-height: 1.8;">
                The URL Frontier is the heart of a web crawler. It must balance <strong>two competing goals</strong>:
            </p>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 15px;">
                <div style="background: #fee2e2; padding: 15px; border-radius: 10px; border-left: 4px solid #dc2626;">
                    <h4 style="color: #991b1b; margin-bottom: 8px;">üìä Priority (Quality)</h4>
                    <p style="font-size: 0.9em; color: #7f1d1d; line-height: 1.6;">
                        Crawl <strong>important pages first</strong> (news sites, popular domains, fresh content).
                        Use PageRank, domain authority, and freshness scores.
                    </p>
                </div>
                <div style="background: #d1fae5; padding: 15px; border-radius: 10px; border-left: 4px solid #10b981;">
                    <h4 style="color: #065f46; margin-bottom: 8px;">ü§ù Politeness (Ethics)</h4>
                    <p style="font-size: 0.9em; color: #064e3b; line-height: 1.6;">
                        Don't overwhelm servers. <strong>Rate limit per domain</strong> (typically 1-5 requests/sec).
                        Respect robots.txt and Crawl-delay directives.
                    </p>
                </div>
            </div>
            <h4 style="color: #6366f1; margin-top: 15px;">Two-Tier Queue Architecture:</h4>
            <ol style="margin-left: 20px; line-height: 2;">
                <li><strong>Front Queues (F1-F5):</strong> Priority-based queues. URLs are assigned based on importance score. Selector picks from F1 more often than F5 (biased sampling).</li>
                <li><strong>Back Queues (B1-Bn):</strong> One queue per domain. Ensures we don't send requests to the same domain too quickly. Each queue tracks last fetch time and enforces rate limits.</li>
            </ol>
            <div style="margin-top: 15px; padding: 15px; background: #fef3c7; border-left: 4px solid #f59e0b; border-radius: 5px;">
                <strong>üéØ Example:</strong> A high-priority URL from cnn.com goes to F1 (urgent queue), then routed to B_cnn (back queue for cnn.com domain). If B_cnn was accessed 0.3s ago with 1 req/sec limit, we wait 0.7s before fetching.
            </div>
        </div>
    </div>

    <!-- Complete System Flow -->
    <div id="full-diagram" class="diagram-container">
        <svg viewBox="0 0 1600 1000" xmlns="http://www.w3.org/2000/svg">
            <!-- Title -->
            <text x="800" y="35" font-size="28" font-weight="bold" text-anchor="middle" fill="#2d3748">
                Complete Web Crawler System Flow
            </text>

            <!-- Layer labels -->
            <text x="50" y="110" font-size="13" font-weight="bold" fill="#64748b" transform="rotate(-90 50 110)">INPUT</text>
            <text x="50" y="250" font-size="13" font-weight="bold" fill="#64748b" transform="rotate(-90 50 250)">SCHEDULING</text>
            <text x="50" y="450" font-size="13" font-weight="bold" fill="#64748b" transform="rotate(-90 50 450)">FETCH & PARSE</text>
            <text x="50" y="720" font-size="13" font-weight="bold" fill="#64748b" transform="rotate(-90 50 720)">STORAGE & INDEX</text>

            <!-- Divider lines -->
            <line x1="100" y1="180" x2="1550" y2="180" stroke="#e2e8f0" stroke-width="2" stroke-dasharray="10,5"/>
            <line x1="100" y1="350" x2="1550" y2="350" stroke="#e2e8f0" stroke-width="2" stroke-dasharray="10,5"/>
            <line x1="100" y1="600" x2="1550" y2="600" stroke="#e2e8f0" stroke-width="2" stroke-dasharray="10,5"/>

            <!-- INPUT LAYER -->
            <g class="component">
                <rect x="200" y="80" width="200" height="70" rx="8" fill="#fde047" stroke="#facc15" stroke-width="2"/>
                <text x="300" y="110" font-size="14" font-weight="bold" text-anchor="middle" fill="#854d0e">üå± Seed URLs</text>
                <text x="300" y="130" font-size="10" text-anchor="middle" fill="#854d0e">Initial crawl list</text>
            </g>

            <g class="component">
                <rect x="450" y="80" width="200" height="70" rx="8" fill="#fde047" stroke="#facc15" stroke-width="2"/>
                <text x="550" y="110" font-size="14" font-weight="bold" text-anchor="middle" fill="#854d0e">üìÑ Sitemaps</text>
                <text x="550" y="130" font-size="10" text-anchor="middle" fill="#854d0e">XML site indexes</text>
            </g>

            <g class="component">
                <rect x="700" y="80" width="200" height="70" rx="8" fill="#fde047" stroke="#facc15" stroke-width="2"/>
                <text x="800" y="110" font-size="14" font-weight="bold" text-anchor="middle" fill="#854d0e">üîó Discovered URLs</text>
                <text x="800" y="130" font-size="10" text-anchor="middle" fill="#854d0e">From parsing</text>
            </g>

            <!-- Arrows down -->
            <path d="M 300 150 L 550 210" stroke="#6366f1" stroke-width="2" fill="none" marker-end="url(#arrowhead)"/>
            <path d="M 550 150 L 550 210" stroke="#6366f1" stroke-width="2" fill="none" marker-end="url(#arrowhead)"/>
            <path d="M 800 150 L 650 210" stroke="#6366f1" stroke-width="2" fill="none" marker-end="url(#arrowhead)"/>

            <!-- SCHEDULING LAYER -->
            <g class="component">
                <rect x="150" y="210" width="250" height="110" rx="8" fill="#c7d2fe" stroke="#6366f1" stroke-width="2"/>
                <text x="275" y="245" font-size="14" font-weight="bold" text-anchor="middle" fill="#4338ca">üîç Deduplication</text>
                <text x="275" y="265" font-size="10" text-anchor="middle" fill="#4338ca">Bloom filter check</text>
                <text x="275" y="280" font-size="10" text-anchor="middle" fill="#4338ca">URL normalization</text>
            </g>

            <path d="M 400 265 L 480 265" stroke="#6366f1" stroke-width="2" fill="none" marker-end="url(#arrowhead)"/>

            <g class="component">
                <rect x="480" y="210" width="300" height="110" rx="8" fill="#bfdbfe" stroke="#3b82f6" stroke-width="2"/>
                <text x="630" y="250" font-size="15" font-weight="bold" text-anchor="middle" fill="#1e40af">üö™ URL Frontier</text>
                <text x="630" y="275" font-size="10" text-anchor="middle" fill="#1e40af">Priority queues (F1-F5)</text>
                <text x="630" y="290" font-size="10" text-anchor="middle" fill="#1e40af">Domain queues (B1-Bn)</text>
                <text x="630" y="305" font-size="10" text-anchor="middle" fill="#1e40af">Politeness enforcement</text>
            </g>

            <path d="M 780 265 L 860 265" stroke="#6366f1" stroke-width="2" fill="none" marker-end="url(#arrowhead)"/>

            <g class="component">
                <rect x="860" y="210" width="200" height="110" rx="8" fill="#e0e7ff" stroke="#818cf8" stroke-width="2"/>
                <text x="960" y="250" font-size="13" font-weight="bold" text-anchor="middle" fill="#4338ca">‚è∞ Scheduler</text>
                <text x="960" y="275" font-size="10" text-anchor="middle" fill="#4338ca">Select next URL</text>
                <text x="960" y="290" font-size="10" text-anchor="middle" fill="#4338ca">Check rate limits</text>
            </g>

            <!-- Arrow down to fetch layer -->
            <path d="M 630 320 L 630 380" stroke="#6366f1" stroke-width="3" fill="none" marker-end="url(#arrowhead)"/>

            <!-- FETCH & PARSE LAYER -->
            <g class="component">
                <rect x="150" y="380" width="200" height="90" rx="8" fill="#ddd6fe" stroke="#a78bfa" stroke-width="2"/>
                <text x="250" y="415" font-size="13" font-weight="bold" text-anchor="middle" fill="#6b21a8">ü§ñ Robots.txt</text>
                <text x="250" y="435" font-size="10" text-anchor="middle" fill="#6b21a8">Check permissions</text>
                <text x="250" y="450" font-size="10" text-anchor="middle" fill="#6b21a8">Cache rules</text>
            </g>

            <g class="component">
                <rect x="400" y="380" width="200" height="90" rx="8" fill="#bae6fd" stroke="#38bdf8" stroke-width="2"/>
                <text x="500" y="415" font-size="13" font-weight="bold" text-anchor="middle" fill="#075985">üåê DNS Resolver</text>
                <text x="500" y="435" font-size="10" text-anchor="middle" fill="#075985">Cached lookups</text>
                <text x="500" y="450" font-size="10" text-anchor="middle" fill="#075985">IP resolution</text>
            </g>

            <g class="component">
                <rect x="650" y="380" width="300" height="90" rx="8" fill="#a5f3fc" stroke="#22d3ee" stroke-width="2"/>
                <text x="800" y="415" font-size="15" font-weight="bold" text-anchor="middle" fill="white">üì• HTTP Fetcher</text>
                <text x="800" y="435" font-size="10" text-anchor="middle" fill="white">Connection pooling</text>
                <text x="800" y="450" font-size="10" text-anchor="middle" fill="white">Retry logic, timeout handling</text>
            </g>

            <g class="component">
                <rect x="1000" y="380" width="200" height="90" rx="8" fill="#fca5a5" stroke="#ef4444" stroke-width="2"/>
                <text x="1100" y="415" font-size="13" font-weight="bold" text-anchor="middle" fill="white">‚è±Ô∏è Rate Limiter</text>
                <text x="1100" y="435" font-size="10" text-anchor="middle" fill="white">Token bucket</text>
                <text x="1100" y="450" font-size="10" text-anchor="middle" fill="white">1-5 req/sec</text>
            </g>

            <!-- Arrow to parser -->
            <path d="M 800 470 L 800 520" stroke="#6366f1" stroke-width="3" fill="none" marker-end="url(#arrowhead)"/>

            <g class="component">
                <rect x="600" y="520" width="400" height="70" rx="8" fill="#d9f99d" stroke="#84cc16" stroke-width="2"/>
                <text x="800" y="550" font-size="15" font-weight="bold" text-anchor="middle" fill="#365314">üìÑ HTML/Content Parser</text>
                <text x="800" y="570" font-size="10" text-anchor="middle" fill="#365314">Extract: text, links, metadata | Normalize & clean content</text>
            </g>

            <!-- Arrows to storage -->
            <path d="M 700 590 L 500 640" stroke="#6366f1" stroke-width="2" fill="none" marker-end="url(#arrowhead)"/>
            <path d="M 900 590 L 1100 640" stroke="#6366f1" stroke-width="2" fill="none" marker-end="url(#arrowhead)"/>
            <path d="M 800 590 L 800 760" stroke="#6366f1" stroke-width="2" fill="none" marker-end="url(#arrowhead)"/>

            <!-- STORAGE & INDEX LAYER -->
            <g class="component">
                <rect x="200" y="640" width="300" height="100" rx="8" fill="#fed7aa" stroke="#fb923c" stroke-width="2"/>
                <text x="350" y="675" font-size="14" font-weight="bold" text-anchor="middle" fill="#9a3412">üíæ Content Storage</text>
                <text x="350" y="695" font-size="10" text-anchor="middle" fill="#9a3412">S3 / HDFS / Blob Storage</text>
                <text x="350" y="710" font-size="10" text-anchor="middle" fill="#9a3412">Compressed documents</text>
            </g>

            <g class="component">
                <rect x="950" y="640" width="300" height="100" rx="8" fill="#e9d5ff" stroke="#c084fc" stroke-width="2"/>
                <text x="1100" y="675" font-size="14" font-weight="bold" text-anchor="middle" fill="#6b21a8">üîé Search Index</text>
                <text x="1100" y="695" font-size="10" text-anchor="middle" fill="#6b21a8">Elasticsearch / Solr</text>
                <text x="1100" y="710" font-size="10" text-anchor="middle" fill="#6b21a8">Inverted index building</text>
            </g>

            <g class="component">
                <rect x="550" y="760" width="500" height="100" rx="8" fill="#d1fae5" stroke="#10b981" stroke-width="2"/>
                <text x="800" y="795" font-size="15" font-weight="bold" text-anchor="middle" fill="#065f46">üóÑÔ∏è URL Metadata Database</text>
                <text x="800" y="815" font-size="11" text-anchor="middle" fill="#065f46">PostgreSQL / Cassandra (Sharded)</text>
                <text x="800" y="835" font-size="10" text-anchor="middle" fill="#065f46">Store: URL, crawl status, timestamps, PageRank, crawl frequency</text>
            </g>

            <!-- Feedback loop -->
            <path d="M 200 680 L 100 680 L 100 265 L 150 265" stroke="#10b981" stroke-width="3" fill="none" marker-end="url(#arrowhead)" stroke-dasharray="8,4"/>
            <text x="70" y="470" font-size="12" fill="#059669" font-weight="700" transform="rotate(-90 70 470)">Discovered URLs ‚Üí Frontier</text>

            <!-- Monitoring -->
            <g class="component">
                <rect x="1300" y="380" width="250" height="150" rx="8" fill="#fef3c7" stroke="#facc15" stroke-width="2"/>
                <text x="1425" y="420" font-size="14" font-weight="bold" text-anchor="middle" fill="#854d0e">üìä Monitoring</text>
                <text x="1425" y="445" font-size="10" text-anchor="middle" fill="#854d0e">‚Ä¢ Crawl rate: 1500 p/s</text>
                <text x="1425" y="465" font-size="10" text-anchor="middle" fill="#854d0e">‚Ä¢ Queue depth: 50M URLs</text>
                <text x="1425" y="485" font-size="10" text-anchor="middle" fill="#854d0e">‚Ä¢ Success rate: 94.2%</text>
                <text x="1425" y="505" font-size="10" text-anchor="middle" fill="#854d0e">‚Ä¢ Avg latency: 350ms</text>
            </g>

            <!-- Arrows to monitoring -->
            <path d="M 1000 425 L 1300 425" stroke="#facc15" stroke-width="2" fill="none" stroke-dasharray="3,3"/>
            <path d="M 1050 690 L 1425 530" stroke="#facc15" stroke-width="2" fill="none" stroke-dasharray="3,3"/>

        </svg>

        <div class="flow-description">
            <h3>üèóÔ∏è Complete System Data Flow</h3>
            <p style="margin-bottom: 15px; line-height: 1.8;">
                This diagram shows the complete end-to-end flow of data through the web crawler system.
            </p>
            <h4 style="color: #6366f1; margin-bottom: 10px;">Key Flow Stages:</h4>
            <ol style="margin-left: 20px; line-height: 2;">
                <li><strong>Input Sources:</strong> Seed URLs, sitemaps, and discovered URLs from parsing all feed into the system</li>
                <li><strong>Scheduling Layer:</strong> Deduplication filters already-seen URLs ‚Üí URL Frontier manages priority and politeness ‚Üí Scheduler selects next URL</li>
                <li><strong>Fetch & Parse:</strong> Check robots.txt ‚Üí DNS lookup ‚Üí HTTP fetch (rate limited) ‚Üí Parse content and extract links</li>
                <li><strong>Storage & Index:</strong> Raw content stored in S3/HDFS ‚Üí Metadata in database ‚Üí Text indexed in Elasticsearch</li>
                <li><strong>Feedback Loop:</strong> Discovered URLs from parser are fed back to deduplication/frontier, creating continuous crawling</li>
            </ol>
            <div style="margin-top: 15px; padding: 15px; background: #d1fae5; border-left: 4px solid #10b981; border-radius: 5px;">
                <strong>üîÑ Continuous Operation:</strong> The crawler runs 24/7 in a continuous loop. As new pages are discovered, they're added to the frontier and eventually crawled, discovering even more pages!
            </div>
        </div>
    </div>

    <!-- Metrics Panel -->
    <div class="metrics-panel">
        <h2 style="margin-bottom: 15px; color: #92400e;">‚ö° Web Crawler Performance Metrics</h2>
        <div class="metrics-grid">
            <div class="metric-card">
                <div class="metric-value">1,500</div>
                <div class="metric-label">Pages/second</div>
            </div>
            <div class="metric-card">
                <div class="metric-value">50M</div>
                <div class="metric-label">URL Frontier Size</div>
            </div>
            <div class="metric-card">
                <div class="metric-value">350ms</div>
                <div class="metric-label">Avg Fetch Latency</div>
            </div>
            <div class="metric-card">
                <div class="metric-value">94.2%</div>
                <div class="metric-label">Success Rate</div>
            </div>
            <div class="metric-card">
                <div class="metric-value">10B+</div>
                <div class="metric-label">Pages Indexed</div>
            </div>
            <div class="metric-card">
                <div class="metric-value">99.5%</div>
                <div class="metric-label">Dedup Accuracy</div>
            </div>
        </div>
    </div>

    <!-- Legend -->
    <div class="legend">
        <div class="legend-item">
            <div class="legend-color" style="background: linear-gradient(135deg, #fde047, #facc15);"></div>
            <span>Input/Seeds</span>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background: linear-gradient(135deg, #60a5fa, #3b82f6);"></div>
            <span>Scheduling</span>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background: linear-gradient(135deg, #22d3ee, #06b6d4);"></div>
            <span>Fetching</span>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background: linear-gradient(135deg, #84cc16, #65a30d);"></div>
            <span>Parsing</span>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background: linear-gradient(135deg, #f87171, #ef4444);"></div>
            <span>Deduplication</span>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background: linear-gradient(135deg, #fb923c, #f97316);"></div>
            <span>Storage</span>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background: linear-gradient(135deg, #c084fc, #a855f7);"></div>
            <span>Indexing</span>
        </div>
    </div>
</div>

<script>
    function showDiagram(type) {
        // Hide all diagrams
        document.querySelectorAll('.diagram-container').forEach(d => {
            d.classList.remove('active');
        });

        // Remove active from all tabs
        document.querySelectorAll('.tab').forEach(t => {
            t.classList.remove('active');
        });

        // Show selected diagram
        document.getElementById(type + '-diagram').classList.add('active');

        // Activate clicked tab
        event.target.classList.add('active');
    }

    // Add hover effects
    document.querySelectorAll('.component').forEach(comp => {
        comp.addEventListener('mouseenter', function() {
            this.style.filter = 'drop-shadow(0 0 15px rgba(99, 102, 241, 0.6))';
        });

        comp.addEventListener('mouseleave', function() {
            this.style.filter = 'none';
        });
    });
</script>
</body>
</html>
